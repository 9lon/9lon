"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var o=0;o<a.length;o++){var t=a[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(a,o,t){return o&&e(a.prototype,o),t&&e(a,t),a}}();!function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"beforeRegister",value:function(){this.is="glon-system",this.properties={role:{type:Object,value:[{path:"app1/page1",role:["admin","manager","user1"]}]}}}},{key:"created",value:function(){window.gl.glonSys=document.querySelector("glon-system"),"undefined"==typeof localStorage.glLanguage&&localStorage.setItem("glLanguage",glonSystem.language);var e=jwt_decode("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiVXNlcjEiLCJyb2xlIjoiYWRtaW4ifQ.oRx_ieJoxSZPv7Y8lM03Qv8Qb24PVmuFpWBUxWEkBcg");this.auth=e}},{key:"_routePageChanged",value:function(e){var a=this,o={};if("/"==e.path){var t=glonSystem.indexPath.split("/");o={app:t[1],page:t[2]}}else o="undefined"==typeof e.path.split("/")[2]?{app:"error",page:"404"}:this.routeData;var l=function(){var e=document.createElement(o.app+"-"+o.page);e.route=o,a.getLocales(a.layout,o.app,function(t){if(window.mergeLocales=t,a.layout!=a.oldLayout){var l=function(){var t=a.$$("tag-app-load");t.innerHTML="";var l=document.createElement(a.layout);l.route=o,l.page=e,t.appendChild(l)};glonSystem.layout!=a.layout?a.importHref(a.resolveUrl("/src/template/"+a.layout+"/"+a.layout+".html"),function(e){l()},function(e){a.changePath("/error/404")},!0):l()}else if("undefined"==typeof a.layout){var n=a.$$("tag-app-load");n.innerHTML="",n.appendChild(e)}else{var n=a.$$("tag-app-load>"+a.layout);n.route=o,n.page=e}a.oldLayout=a.layout})};this.checkRole(o)&&(o={app:"error",page:"403"}),this.importHref(this.resolveUrl("/src/apps/"+o.app+"/"+o.page+".html"),function(e){l()},function(e){o={app:"error",page:"404"},a.importHref(a.resolveUrl("/src/apps/"+o.app+"/"+o.page+".html"),function(e){l()},null,!0)},!0)}},{key:"changePath",value:function(e){this.$.changePath.setAttribute("href",e),this.$.changePath.click()}},{key:"getLocales",value:function(e,a,o){var t=function(){var t=JSON.parse(JSON.stringify(locales.global));if("undefined"!=typeof locales.layouts[e])for(var l in locales.layouts[e])for(var n in locales.layouts[e][l])t[l][n]=locales.layouts[e][l][n];for(var l in locales.apps[a])for(var n in locales.apps[a][l])t[l][n]=locales.apps[a][l][n];o(t)},l={global:!1,layout:!1,app:!1,loaded:function(e){this[e]=!0,this.global&&this.layout&&this.app&&t()}};"undefined"==typeof locales&&(window.locales={global:null,apps:{},layouts:{}}),null==locales.global?axios.get("/src/apps/localize.json").then(function(e){locales.global=e.data,l.loaded("global")}):l.loaded("global"),"undefined"==typeof locales.layouts[e]?axios.get("/src/template/"+e+"/localize.json").then(function(a){locales.layouts[e]=a.data,l.loaded("layout")}):l.loaded("layout"),"undefined"==typeof locales.apps[a]?axios.get("/src/apps/"+a+"/localize.json").then(function(e){locales.apps[a]=e.data,l.loaded("app")}):l.loaded("app")}},{key:"checkRole",value:function(e){var a=this,o=!0;return this.role.map(function(t,l){t.path==e.app+"/"+e.page?t.role.map(function(e){a.auth.role==e&&(o=!1)}):o=!1}),o}},{key:"observers",get:function(){return["_routePageChanged(route)"]}}]),e}();Polymer(e)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdsb24tc3lzdGVtLmpzIl0sIm5hbWVzIjpbIkdsb25TeXMiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiX2NyZWF0ZUNsYXNzIiwia2V5IiwidmFsdWUiLCJpcyIsInByb3BlcnRpZXMiLCJyb2xlIiwidHlwZSIsIk9iamVjdCIsIndpbmRvdyIsImdsIiwiZ2xvblN5cyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImxvY2FsU3RvcmFnZSIsImdsTGFuZ3VhZ2UiLCJzZXRJdGVtIiwibGFuZ3VhZ2UiLCJhdXRoIiwiZGVjb2RlZCIsIl90aGlzIiwicm91dGVEYXRhIiwiZ2V0Um91dGUiLCJwYXRoIiwiaW5kZXhQYXRoIiwiZ2xvblN5c3RlbSIsInNwbGl0IiwiYXBwIiwicGFnZSIsImdldFBhZ2UiLCJjcmVhdGVFbGVtZW50Iiwicm91dGUiLCJnZXRMb2NhbGVzIiwibGF5b3V0IiwiZGF0YSIsInJlbmRlclBhZ2UiLCJtZXJnZUxvY2FsZXMiLCJyZW5kZXJMYXlvdXQiLCJxdWVyeVRhZyIsImlubmVySFRNTCIsIm9sZExheW91dCIsImdldExheW91dCIsImFwcGVuZENoaWxkIiwiaW1wb3J0SHJlZiIsImUiLCJjaGFuZ2VQYXRoIiwiJCQiLCJjaGVja1JvbGUiLCJyZXNvbHZlVXJsIiwiJCIsInNldEF0dHJpYnV0ZSIsImNsaWNrIiwiY2FsbGJhY2siLCJtZXJnZURhdGEiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJsb2NhbGVzIiwiZ2xvYmFsIiwibGF5b3V0cyIsImtleTIiLCJwb2ludGVyIiwiYXBwcyIsImxvY2FsZXNMb2FkZWQiLCJsb2FkZWQiLCJnZXQiLCJ0aGVuIiwicmVzcG9uc2UiLCJheGlvcyIsInJlZGlyZWN0IiwiaW5kZXgiLCJvYmoiLCJfdGhpczIiLCJtYXAiLCJzT2JqIiwiUG9seW1lciJdLCJtYXBwaW5ncyI6IjhYQUFBLFdBQVksR0FJQUEsR0FKQSxXQUFBLFFBQUFBLEtBQUFDLGdCQUFBQyxLQUFBRixHQUFBLE1B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QUF4RSxLQTdNVnFFLEdBQUEsQ0EyTkYsT0EzTkVyRSxNQUFBTSxLQUFBbUUsSUFBQSxTQUFBRixFQUFBRCxHQWdOR0MsRUFBSWhELE1BQU9JLEVBQUlBLElBQUksSUFBSUEsRUFBSUMsS0FpQjVCOUIsRUFBUlEsS0FBQW1FLElBQUEsU0FBQUMsR0FqT05GLEVBQUF0RCxLQUFBWixNQUFBb0UsSUFtTmtCTCxHQUFXLEtBSWZBLEdBQVcsSUFJUkEsS0EzTkxuRSxJQUFBLFlBQUErRCxJQUFBLFdBQ04sT0FPTSxnQ0FSQW5FLElBaU9ONkUsU0FBUTdFIiwiZmlsZSI6Imdsb24tc3lzdGVtLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCkge1xuICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgIFxuICAgIFxuICAgICAgY2xhc3MgR2xvblN5cyB7XG5cbiAgICAgICAgZ2V0IG9ic2VydmVycygpIHtcbiAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgJ19yb3V0ZVBhZ2VDaGFuZ2VkKHJvdXRlKSdcbiAgICAgICAgICBdO1xuICAgICAgICB9XG5cbiAgICAgICAgYmVmb3JlUmVnaXN0ZXIoKSB7XG4gICAgICAgICAgdGhpcy5pcyA9ICdnbG9uLXN5c3RlbSc7XG4gICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0ge1xuICAgICAgICAgICAgcm9sZTp7XG4gICAgICAgICAgICAgIHR5cGU6T2JqZWN0LFxuICAgICAgICAgICAgICB2YWx1ZTpbXG4gICAgICAgICAgICAgICAgeyBwYXRoOidhcHAxL3BhZ2UxJyxyb2xlOlsnYWRtaW4nLCdtYW5hZ2VyJywndXNlcjEnXX1cbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBjcmVhdGVkKCl7XG4gICAgICAgICAgd2luZG93LmdsLmdsb25TeXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiZ2xvbi1zeXN0ZW1cIik7XG5cbiAgICAgICAgICBpZih0eXBlb2YgbG9jYWxTdG9yYWdlLmdsTGFuZ3VhZ2UgPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJnbExhbmd1YWdlXCIsIGdsb25TeXN0ZW0ubGFuZ3VhZ2UpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciBkZWNvZGVkID0gand0X2RlY29kZSgnZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SjFjMlZ5SWpvaVZYTmxjakVpTENKeWIyeGxJam9pWVdSdGFXNGlmUS5vUnhfaWVKb3hTWlB2N1k4bE0wM1F2OFFiMjRQVm11RnBXQlV4V0VrQmNnJyk7XG4gICAgICAgICAgdGhpcy5hdXRoID0gZGVjb2RlZDtcbiAgICAgICAgfVxuXG4gICAgICAgIF9yb3V0ZVBhZ2VDaGFuZ2VkKGdldFJvdXRlKXtcblxuICAgICAgICAgIHZhciByb3V0ZURhdGEgPSB7fTtcbiAgICAgICAgICBpZihnZXRSb3V0ZS5wYXRoID09IFwiL1wiKXtcbiAgICAgICAgICAgIHZhciBpbmRleFBhdGggPSBnbG9uU3lzdGVtLmluZGV4UGF0aC5zcGxpdCgnLycpO1xuICAgICAgICAgICAgcm91dGVEYXRhID0geyBhcHA6aW5kZXhQYXRoWzFdLHBhZ2U6aW5kZXhQYXRoWzJdIH07XG4gICAgICAgICAgfWVsc2UgaWYodHlwZW9mIGdldFJvdXRlLnBhdGguc3BsaXQoJy8nKVsyXSA9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICAgIHJvdXRlRGF0YSA9IHsgYXBwOidlcnJvcicscGFnZTonNDA0JyB9O1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgcm91dGVEYXRhID0gdGhpcy5yb3V0ZURhdGE7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIHJlbmRlclBhZ2UgPSAoKT0+e1xuICAgICAgICAgICAgICAgIHZhciBnZXRQYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChyb3V0ZURhdGEuYXBwKyctJytyb3V0ZURhdGEucGFnZSk7XG4gICAgICAgICAgICAgICAgZ2V0UGFnZS5yb3V0ZSA9IHJvdXRlRGF0YTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0TG9jYWxlcyh0aGlzLmxheW91dCxyb3V0ZURhdGEuYXBwLChkYXRhKT0+e1xuICAgICAgICAgICAgICAgICAgd2luZG93Lm1lcmdlTG9jYWxlcyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgICBpZigodGhpcy5sYXlvdXQhPXRoaXMub2xkTGF5b3V0KSl7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlbmRlckxheW91dCA9ICgpPT57XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5VGFnID0gdGhpcy4kJCgndGFnLWFwcC1sb2FkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcuaW5uZXJIVE1MPScnO1xuICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRMYXlvdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRoaXMubGF5b3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICBnZXRMYXlvdXQucm91dGUgPSByb3V0ZURhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgZ2V0TGF5b3V0LnBhZ2UgPSBnZXRQYWdlO1xuICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLmFwcGVuZENoaWxkKGdldExheW91dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZihnbG9uU3lzdGVtLmxheW91dCE9dGhpcy5sYXlvdXQpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbXBvcnRIcmVmKFxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc29sdmVVcmwoJy9zcmMvdGVtcGxhdGUvJyt0aGlzLmxheW91dCsnLycrdGhpcy5sYXlvdXQrJy5odG1sJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAoZSk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyTGF5b3V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgKGUpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlUGF0aCgnL2Vycm9yLzQwNCcpXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICByZW5kZXJMYXlvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mIHRoaXMubGF5b3V0ID09IFwidW5kZWZpbmVkXCIpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnlUYWcgPSB0aGlzLiQkKCd0YWctYXBwLWxvYWQnKTtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcuaW5uZXJIVE1MPScnO1xuICAgICAgICAgICAgICAgICAgICBxdWVyeVRhZy5hcHBlbmRDaGlsZChnZXRQYWdlKTtcbiAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnlUYWcgPSB0aGlzLiQkKCd0YWctYXBwLWxvYWQ+Jyt0aGlzLmxheW91dCk7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLnJvdXRlID0gcm91dGVEYXRhO1xuICAgICAgICAgICAgICAgICAgICBxdWVyeVRhZy5wYWdlID0gZ2V0UGFnZTtcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgdGhpcy5vbGRMYXlvdXQgPSB0aGlzLmxheW91dDtcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgIGlmKHRoaXMuY2hlY2tSb2xlKHJvdXRlRGF0YSkpe1xuICAgICAgICAgICAgcm91dGVEYXRhID0geyBhcHA6J2Vycm9yJyxwYWdlOic0MDMnIH07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5pbXBvcnRIcmVmKFxuICAgICAgICAgICAgdGhpcy5yZXNvbHZlVXJsKCcvc3JjL2FwcHMvJytyb3V0ZURhdGEuYXBwKycvJytyb3V0ZURhdGEucGFnZSsnLmh0bWwnKSxcbiAgICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICByZW5kZXJQYWdlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGUpPT57XG4gICAgICAgICAgICAgICAgcm91dGVEYXRhID0geyBhcHA6J2Vycm9yJyxwYWdlOic0MDQnIH07XG4gICAgICAgICAgICAgICAgdGhpcy5pbXBvcnRIcmVmKFxuICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlVXJsKCcvc3JjL2FwcHMvJytyb3V0ZURhdGEuYXBwKycvJytyb3V0ZURhdGEucGFnZSsnLmh0bWwnKSxcbiAgICAgICAgICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJQYWdlKCk7XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgIHRydWVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgICApO1xuICAgICAgICAgIFxuICAgICAgICBcbiAgICAgICAgfVxuXG5cbiAgICAgICAgY2hhbmdlUGF0aChwYXRoKXtcbiAgICAgICAgICB0aGlzLiQuY2hhbmdlUGF0aC5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsIHBhdGgpO1xuICAgICAgICAgIHRoaXMuJC5jaGFuZ2VQYXRoLmNsaWNrKCk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGdldExvY2FsZXMobGF5b3V0LGFwcCxjYWxsYmFjayl7XG5cbiAgICAgICAgICB2YXIgbWVyZ2VMb2NhbGVzID0gKCkgPT4ge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgbWVyZ2VEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShsb2NhbGVzLmdsb2JhbCkpO1xuICAgICAgXG5cbiAgICAgICAgICAgIGlmKHR5cGVvZiBsb2NhbGVzLmxheW91dHNbbGF5b3V0XSAhPSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICAgICAgZm9yKHZhciBrZXkgaW4gbG9jYWxlcy5sYXlvdXRzW2xheW91dF0pIHtcbiAgICAgICAgICAgICAgICAgIGZvcih2YXIga2V5MiBpbiBsb2NhbGVzLmxheW91dHNbbGF5b3V0XVtrZXldKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lcmdlRGF0YVtrZXldW2tleTJdID0gbG9jYWxlcy5sYXlvdXRzW2xheW91dF1ba2V5XVtrZXkyXTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBcblxuICAgICAgICAgICAgZm9yKHZhciBrZXkgaW4gbG9jYWxlcy5hcHBzW2FwcF0pIHtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGtleTIgaW4gbG9jYWxlcy5hcHBzW2FwcF1ba2V5XSkge1xuICAgICAgICAgICAgICAgICAgbWVyZ2VEYXRhW2tleV1ba2V5Ml0gPSBsb2NhbGVzLmFwcHNbYXBwXVtrZXldW2tleTJdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxiYWNrKG1lcmdlRGF0YSk7XG5cbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgbG9jYWxlc0xvYWRlZCA9IHtcbiAgICAgICAgICAgIGdsb2JhbDpmYWxzZSxcbiAgICAgICAgICAgIGxheW91dDpmYWxzZSxcbiAgICAgICAgICAgIGFwcDpmYWxzZSxcbiAgICAgICAgICAgIGxvYWRlZDpmdW5jdGlvbiAocG9pbnRlcikge1xuICAgICAgICAgICAgICB0aGlzW3BvaW50ZXJdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgaWYodGhpcy5nbG9iYWwmJnRoaXMubGF5b3V0JiZ0aGlzLmFwcCl7XG4gICAgICAgICAgICAgICAgbWVyZ2VMb2NhbGVzKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cblxuICAgICAgICAgIGlmKHR5cGVvZiBsb2NhbGVzID09ICd1bmRlZmluZWQnKXtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbGVzID0ge2dsb2JhbDpudWxsLGFwcHM6e30sbGF5b3V0czp7fX07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYobG9jYWxlcy5nbG9iYWw9PW51bGwpe1xuICAgICAgICAgICAgYXhpb3MuZ2V0KCcvc3JjL2FwcHMvbG9jYWxpemUuanNvbicpXG4gICAgICAgICAgICAudGhlbigocmVzcG9uc2UpPT57XG4gICAgICAgICAgICAgIGxvY2FsZXMuZ2xvYmFsID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2dsb2JhbCcpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdnbG9iYWwnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZih0eXBlb2YgbG9jYWxlcy5sYXlvdXRzW2xheW91dF0gPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgICAgYXhpb3MuZ2V0KCcvc3JjL3RlbXBsYXRlLycrbGF5b3V0KycvbG9jYWxpemUuanNvbicpXG4gICAgICAgICAgICAudGhlbigocmVzcG9uc2UpPT57XG4gICAgICAgICAgICAgIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2xheW91dCcpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdsYXlvdXQnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZih0eXBlb2YgbG9jYWxlcy5hcHBzW2FwcF0gPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgICAgYXhpb3MuZ2V0KCcvc3JjL2FwcHMvJythcHArJy9sb2NhbGl6ZS5qc29uJylcbiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSk9PntcbiAgICAgICAgICAgICAgbG9jYWxlcy5hcHBzW2FwcF0gPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnYXBwJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2FwcCcpO1xuICAgICAgICAgIH1cblxuICAgICAgICB9XG5cblxuICAgICAgICBjaGVja1JvbGUoYXBwKXtcbiAgICAgICAgICB2YXIgcmVkaXJlY3QgPSB0cnVlO1xuICAgICAgICAgIHRoaXMucm9sZS5tYXAoKG9iaixpbmRleCk9PntcbiAgICAgICAgICAgIGlmKG9iai5wYXRoPT0oYXBwLmFwcCsnLycrYXBwLnBhZ2UpKXtcbiAgICAgICAgICAgICAgb2JqLnJvbGUubWFwKChzT2JqKT0+e1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuYXV0aC5yb2xlPT1zT2JqKXtcbiAgICAgICAgICAgICAgICAgIHJlZGlyZWN0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICByZWRpcmVjdCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcmV0dXJuIHJlZGlyZWN0O1xuICAgICAgICB9XG4gICAgICAgICAgXG5cbiAgICAgIH1cblxuICAgICAgUG9seW1lcihHbG9uU3lzKTtcblxuICAgIH0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
