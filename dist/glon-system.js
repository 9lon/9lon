"use strict";function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,o){for(var a=0;a<o.length;a++){var t=o[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(o,a,t){return a&&e(o.prototype,a),t&&e(o,t),o}}();!function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"beforeRegister",value:function(){this.is="glon-system",this.properties={role:{type:Object,value:[{path:"app1/page1",role:["admin","manager","user1"]}]}}}},{key:"created",value:function(){window.gl.glonSystem=document.querySelector("glon-system"),"undefined"==typeof localStorage.glLanguage&&localStorage.setItem("glLanguage",glonInit.language);var e=jwt_decode("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiVXNlcjEiLCJyb2xlIjoiYWRtaW4ifQ.oRx_ieJoxSZPv7Y8lM03Qv8Qb24PVmuFpWBUxWEkBcg");this.auth=e}},{key:"_routePageChanged",value:function(e){var o=this,a={};if("/"==e.path){var t=glonInit.indexPath.split("/");a={app:t[1],page:t[2]}}else a="undefined"==typeof e.path.split("/")[2]?{app:"error",page:"404"}:this.routeData;var l=function(){var e=document.createElement(a.app+"-"+a.page);e.route=a,o.getLocales(o.layout,a.app,function(t){if(window.mergeLocales=t,o.layout!=o.oldLayout){var l=function(){var t=o.$$("tag-app-load");t.innerHTML="";var l=document.createElement(o.layout);l.route=a,l.page=e,t.appendChild(l)};glonInit.layout!=o.layout?o.importHref(o.resolveUrl("/src/template/"+o.layout+"/"+o.layout+".html"),function(e){l()},function(e){o.changePath("/error/404")},!0):l()}else if("undefined"==typeof o.layout){var n=o.$$("tag-app-load");n.innerHTML="",n.appendChild(e)}else{var n=o.$$("tag-app-load>"+o.layout);n.route=a,n.page=e}o.oldLayout=o.layout})};this.checkRole(a)&&(a={app:"error",page:"403"}),this.importHref(this.resolveUrl("/src/apps/"+a.app+"/"+a.page+".html"),function(e){l()},function(e){a={app:"error",page:"404"},o.importHref(o.resolveUrl("/src/apps/"+a.app+"/"+a.page+".html"),function(e){l()},null,!0)},!0)}},{key:"changePath",value:function(e){this.$.changePath.setAttribute("href",e),this.$.changePath.click()}},{key:"getLocales",value:function(e,o,a){var t=function(){var t=JSON.parse(JSON.stringify(locales.global));if("undefined"!=typeof locales.layouts[e])for(var l in locales.layouts[e])for(var n in locales.layouts[e][l])t[l][n]=locales.layouts[e][l][n];for(var l in locales.apps[o])for(var n in locales.apps[o][l])t[l][n]=locales.apps[o][l][n];a(t)},l={global:!1,layout:!1,app:!1,loaded:function(e){this[e]=!0,this.global&&this.layout&&this.app&&t()}};"undefined"==typeof locales&&(window.locales={global:null,apps:{},layouts:{}}),null==locales.global?fetch(this.resolveUrl("/src/apps/localize.json")).then(function(e){return 200!==e.status?void console.log("Looks like there was a problem. Status Code: "+e.status):void e.json().then(function(e){locales.global=e,l.loaded("global")})}).catch(function(e){console.log("Fetch Error :-S",e)}):l.loaded("global"),"undefined"==typeof locales.layouts[e]?fetch(this.resolveUrl("/src/template/"+e+"/localize.json")).then(function(o){return 200!==o.status?void console.log("Looks like there was a problem. Status Code: "+o.status):void o.json().then(function(o){locales.layouts[e]=o,l.loaded("layout")})}).catch(function(e){console.log("Fetch Error :-S",e)}):l.loaded("layout"),"undefined"==typeof locales.apps[o]?fetch(this.resolveUrl("/src/apps/"+o+"/localize.json")).then(function(e){return 200!==e.status?void console.log("Looks like there was a problem. Status Code: "+e.status):void e.json().then(function(e){locales.apps[o]=e,l.loaded("app")})}).catch(function(e){console.log("Fetch Error :-S",e)}):l.loaded("app")}},{key:"checkRole",value:function(e){var o=this,a=!0;return this.role.map(function(t,l){t.path==e.app+"/"+e.page?t.role.map(function(e){o.auth.role==e&&(a=!1)}):a=!1}),a}},{key:"observers",get:function(){return["_routePageChanged(route)"]}}]),e}();Polymer(e)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdsb24tc3lzdGVtLmpzIl0sIm5hbWVzIjpbIkdsb25TeXN0ZW0iLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiX2NyZWF0ZUNsYXNzIiwia2V5IiwidmFsdWUiLCJpcyIsInByb3BlcnRpZXMiLCJyb2xlIiwidHlwZSIsIk9iamVjdCIsIndpbmRvdyIsImdsIiwiZ2xvblN5c3RlbSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImxvY2FsU3RvcmFnZSIsImdsTGFuZ3VhZ2UiLCJsYW5ndWFnZSIsInNldEl0ZW0iLCJhdXRoIiwiZGVjb2RlZCIsIl90aGlzIiwicm91dGVEYXRhIiwiZ2V0Um91dGUiLCJwYXRoIiwiaW5kZXhQYXRoIiwiZ2xvbkluaXQiLCJhcHAiLCJwYWdlIiwic3BsaXQiLCJnZXRQYWdlIiwiY3JlYXRlRWxlbWVudCIsInJvdXRlIiwiZ2V0TG9jYWxlcyIsImxheW91dCIsImRhdGEiLCJyZW5kZXJQYWdlIiwibWVyZ2VMb2NhbGVzIiwicmVuZGVyTGF5b3V0IiwicXVlcnlUYWciLCJpbm5lckhUTUwiLCJvbGRMYXlvdXQiLCJnZXRMYXlvdXQiLCJhcHBlbmRDaGlsZCIsImltcG9ydEhyZWYiLCJlIiwiY2hhbmdlUGF0aCIsIiQkIiwiY2hlY2tSb2xlIiwicmVzb2x2ZVVybCIsIiQiLCJzZXRBdHRyaWJ1dGUiLCJjbGljayIsImNhbGxiYWNrIiwibWVyZ2VEYXRhIiwiSlNPTiIsInBhcnNlIiwic3RyaW5naWZ5IiwibG9jYWxlcyIsImdsb2JhbCIsImxheW91dHMiLCJrZXkyIiwicG9pbnRlciIsImFwcHMiLCJjb25zb2xlIiwicmVzcG9uc2UiLCJsb2NhbGVzTG9hZGVkIiwibG9hZGVkIiwiY2F0Y2giLCJzdGF0dXMiLCJsb2ciLCJ0aGVuIiwianNvbiIsImVyciIsIm9iaiIsImZldGNoIiwicmVkaXJlY3QiLCJfdGhpczIiLCJtYXAiLCJpbmRleCIsInNPYmoiLCJnZXQiLCJQb2x5bWVyIl0sIm1hcHBpbmdzIjoiOFhBQUEsV0FB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QUFBcEMsR0FDRHVCLFFBQUFFLFFBQUExQixHQUFBQyxFQUVGK0IsRUFBQUMsT0FBQSxjQUdhQyxNQUFBLFNBQUFLLEdBaENSVCxRQUFRTSxJQUFJLGtCQUFtQkcsS0FvQy9CQyxFQUFhUCxPQUFBLFVBR1YsbUJBQUFULFNBQUFLLEtBQUFwQyxHQUpMZ0QsTUFNSzFFLEtBQUFnRCxXQUFBLGFBQUF0QixFQUFBLG1CQUNIaUQsS0FDRCxTQUFBWCxHQVRILE1BQUEsT0FBQUEsRUFBQUksV0FyQlFMLFNBQVFNLElBQUksZ0RBQW1ETCxFQUFTSSxZQTlOOUVKLEdBQUFPLE9BQUFELEtBQUEsU0FBQXBDLEdBQUF1QixRQUFBSyxLQUFBcEMsR0FBQVEsRUFBQStCLEVBTVlDLE9BQUEsV0FpT1hDLE1BQU0sU0FBQ0ssR0F2T1JULFFBQUFNLElBQUEsa0JBQUFHLEtBcVFFMUUsRUFBUm9FLE9BQUEsVUFyUU1oRSxJQUFBLFlBQUFDLE1BQUEsU0FpUE11QixHQUFJLEdBQUFrRCxHQUFBNUUsS0FDUjJFLEdBQVcsQ0FhZixPQVpBM0UsTUFBS00sS0FBS3VFLElBQUksU0FBQ0osRUFBSUssR0FDZEwsRUFBSWxELE1BQU9HLEVBQUlBLElBQUksSUFBSUEsRUFBSUMsS0FDNUI4QyxFQUFJbkUsS0FBS3VFLElBQUksU0FBQ0UsR0FDVEgsRUFBSzFELEtBQUtaLE1BQU15RSxJQUNqQkosR0FBVyxLQUlmQSxHQUFXLElBSVJBLEtBL1BMekUsSUFBQSxZQUFBOEUsSUFBQSxXQUNOLE9BT00sZ0NBUkFsRixJQXFRTm1GLFNBQVFuRiIsImZpbGUiOiJnbG9uLXN5c3RlbS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgICAgICd1c2Ugc3RyaWN0JztcbiAgICBcbiAgICBcbiAgICAgIGNsYXNzIEdsb25TeXN0ZW0ge1xuXG4gICAgICAgIGdldCBvYnNlcnZlcnMoKSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICdfcm91dGVQYWdlQ2hhbmdlZChyb3V0ZSknXG4gICAgICAgICAgXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJlZm9yZVJlZ2lzdGVyKCkge1xuICAgICAgICAgIHRoaXMuaXMgPSAnZ2xvbi1zeXN0ZW0nO1xuICAgICAgICAgIHRoaXMucHJvcGVydGllcyA9IHtcbiAgICAgICAgICAgIHJvbGU6e1xuICAgICAgICAgICAgICB0eXBlOk9iamVjdCxcbiAgICAgICAgICAgICAgdmFsdWU6W1xuICAgICAgICAgICAgICAgIHsgcGF0aDonYXBwMS9wYWdlMScscm9sZTpbJ2FkbWluJywnbWFuYWdlcicsJ3VzZXIxJ119XG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY3JlYXRlZCgpe1xuICAgICAgICAgIHdpbmRvdy5nbC5nbG9uU3lzdGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImdsb24tc3lzdGVtXCIpO1xuXG4gICAgICAgICAgaWYodHlwZW9mIGxvY2FsU3RvcmFnZS5nbExhbmd1YWdlID09ICd1bmRlZmluZWQnKXtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiZ2xMYW5ndWFnZVwiLCBnbG9uSW5pdC5sYW5ndWFnZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGRlY29kZWQgPSBqd3RfZGVjb2RlKCdleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKMWMyVnlJam9pVlhObGNqRWlMQ0p5YjJ4bElqb2lZV1J0YVc0aWZRLm9SeF9pZUpveFNaUHY3WThsTTAzUXY4UWIyNFBWbXVGcFdCVXhXRWtCY2cnKTtcbiAgICAgICAgICB0aGlzLmF1dGggPSBkZWNvZGVkO1xuICAgICAgICB9XG5cbiAgICAgICAgX3JvdXRlUGFnZUNoYW5nZWQoZ2V0Um91dGUpe1xuXG4gICAgICAgICAgdmFyIHJvdXRlRGF0YSA9IHt9O1xuICAgICAgICAgIGlmKGdldFJvdXRlLnBhdGggPT0gXCIvXCIpe1xuICAgICAgICAgICAgdmFyIGluZGV4UGF0aCA9IGdsb25Jbml0LmluZGV4UGF0aC5zcGxpdCgnLycpO1xuICAgICAgICAgICAgcm91dGVEYXRhID0geyBhcHA6aW5kZXhQYXRoWzFdLHBhZ2U6aW5kZXhQYXRoWzJdIH07XG4gICAgICAgICAgfWVsc2UgaWYodHlwZW9mIGdldFJvdXRlLnBhdGguc3BsaXQoJy8nKVsyXSA9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICAgIHJvdXRlRGF0YSA9IHsgYXBwOidlcnJvcicscGFnZTonNDA0JyB9O1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgcm91dGVEYXRhID0gdGhpcy5yb3V0ZURhdGE7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIHJlbmRlclBhZ2UgPSAoKT0+e1xuICAgICAgICAgICAgICAgIHZhciBnZXRQYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChyb3V0ZURhdGEuYXBwKyctJytyb3V0ZURhdGEucGFnZSk7XG4gICAgICAgICAgICAgICAgZ2V0UGFnZS5yb3V0ZSA9IHJvdXRlRGF0YTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0TG9jYWxlcyh0aGlzLmxheW91dCxyb3V0ZURhdGEuYXBwLChkYXRhKT0+e1xuICAgICAgICAgICAgICAgICAgd2luZG93Lm1lcmdlTG9jYWxlcyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgICBpZigodGhpcy5sYXlvdXQhPXRoaXMub2xkTGF5b3V0KSl7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlbmRlckxheW91dCA9ICgpPT57XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5VGFnID0gdGhpcy4kJCgndGFnLWFwcC1sb2FkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcuaW5uZXJIVE1MPScnO1xuICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRMYXlvdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRoaXMubGF5b3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICBnZXRMYXlvdXQucm91dGUgPSByb3V0ZURhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgZ2V0TGF5b3V0LnBhZ2UgPSBnZXRQYWdlO1xuICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLmFwcGVuZENoaWxkKGdldExheW91dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZihnbG9uSW5pdC5sYXlvdXQhPXRoaXMubGF5b3V0KXtcblxuICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW1wb3J0SHJlZihcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlVXJsKCcvc3JjL3RlbXBsYXRlLycrdGhpcy5sYXlvdXQrJy8nK3RoaXMubGF5b3V0KycuaHRtbCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgKGUpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlckxheW91dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZVBhdGgoJy9lcnJvci80MDQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgcmVuZGVyTGF5b3V0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKHR5cGVvZiB0aGlzLmxheW91dCA9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5VGFnID0gdGhpcy4kJCgndGFnLWFwcC1sb2FkJyk7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLmlubmVySFRNTD0nJztcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcuYXBwZW5kQ2hpbGQoZ2V0UGFnZSk7XG4gICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5VGFnID0gdGhpcy4kJCgndGFnLWFwcC1sb2FkPicrdGhpcy5sYXlvdXQpO1xuICAgICAgICAgICAgICAgICAgICBxdWVyeVRhZy5yb3V0ZSA9IHJvdXRlRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcucGFnZSA9IGdldFBhZ2U7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIHRoaXMub2xkTGF5b3V0ID0gdGhpcy5sYXlvdXQ7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICBpZih0aGlzLmNoZWNrUm9sZShyb3V0ZURhdGEpKXtcbiAgICAgICAgICAgIHJvdXRlRGF0YSA9IHsgYXBwOidlcnJvcicscGFnZTonNDAzJyB9O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuaW1wb3J0SHJlZihcbiAgICAgICAgICAgIHRoaXMucmVzb2x2ZVVybCgnL3NyYy9hcHBzLycrcm91dGVEYXRhLmFwcCsnLycrcm91dGVEYXRhLnBhZ2UrJy5odG1sJyksXG4gICAgICAgICAgICAoZSk9PntcbiAgICAgICAgICAgICAgcmVuZGVyUGFnZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICAgIHJvdXRlRGF0YSA9IHsgYXBwOidlcnJvcicscGFnZTonNDA0JyB9O1xuICAgICAgICAgICAgICAgIHRoaXMuaW1wb3J0SHJlZihcbiAgICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZVVybCgnL3NyYy9hcHBzLycrcm91dGVEYXRhLmFwcCsnLycrcm91dGVEYXRhLnBhZ2UrJy5odG1sJyksXG4gICAgICAgICAgICAgICAgICAoZSk9PntcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyUGFnZSgpO1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICB0cnVlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0cnVlXG4gICAgICAgICAgKTtcbiAgICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIH1cblxuXG4gICAgICAgIGNoYW5nZVBhdGgocGF0aCl7XG4gICAgICAgICAgdGhpcy4kLmNoYW5nZVBhdGguc2V0QXR0cmlidXRlKFwiaHJlZlwiLCBwYXRoKTtcbiAgICAgICAgICB0aGlzLiQuY2hhbmdlUGF0aC5jbGljaygpO1xuICAgICAgICB9XG5cblxuICAgICAgICBnZXRMb2NhbGVzKGxheW91dCxhcHAsY2FsbGJhY2spe1xuXG4gICAgICAgICAgdmFyIG1lcmdlTG9jYWxlcyA9ICgpID0+IHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIG1lcmdlRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobG9jYWxlcy5nbG9iYWwpKTtcbiAgICAgIFxuXG4gICAgICAgICAgICBpZih0eXBlb2YgbG9jYWxlcy5sYXlvdXRzW2xheW91dF0gIT0gXCJ1bmRlZmluZWRcIil7XG4gICAgICAgICAgICAgIGZvcih2YXIga2V5IGluIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdKSB7XG4gICAgICAgICAgICAgICAgICBmb3IodmFyIGtleTIgaW4gbG9jYWxlcy5sYXlvdXRzW2xheW91dF1ba2V5XSkge1xuICAgICAgICAgICAgICAgICAgICBtZXJnZURhdGFba2V5XVtrZXkyXSA9IGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdW2tleV1ba2V5Ml07XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gXG5cbiAgICAgICAgICAgIGZvcih2YXIga2V5IGluIGxvY2FsZXMuYXBwc1thcHBdKSB7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBrZXkyIGluIGxvY2FsZXMuYXBwc1thcHBdW2tleV0pIHtcbiAgICAgICAgICAgICAgICAgIG1lcmdlRGF0YVtrZXldW2tleTJdID0gbG9jYWxlcy5hcHBzW2FwcF1ba2V5XVtrZXkyXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYWxsYmFjayhtZXJnZURhdGEpO1xuXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGxvY2FsZXNMb2FkZWQgPSB7XG4gICAgICAgICAgICBnbG9iYWw6ZmFsc2UsXG4gICAgICAgICAgICBsYXlvdXQ6ZmFsc2UsXG4gICAgICAgICAgICBhcHA6ZmFsc2UsXG4gICAgICAgICAgICBsb2FkZWQ6ZnVuY3Rpb24gKHBvaW50ZXIpIHtcbiAgICAgICAgICAgICAgdGhpc1twb2ludGVyXSA9IHRydWU7XG4gICAgICAgICAgICAgIGlmKHRoaXMuZ2xvYmFsJiZ0aGlzLmxheW91dCYmdGhpcy5hcHApe1xuICAgICAgICAgICAgICAgIG1lcmdlTG9jYWxlcygpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG5cbiAgICAgICAgICBpZih0eXBlb2YgbG9jYWxlcyA9PSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgICB3aW5kb3cubG9jYWxlcyA9IHtnbG9iYWw6bnVsbCxhcHBzOnt9LGxheW91dHM6e319O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmKGxvY2FsZXMuZ2xvYmFsPT1udWxsKXtcbiAgICAgICAgICAgIGZldGNoKHRoaXMucmVzb2x2ZVVybCgnL3NyYy9hcHBzL2xvY2FsaXplLmpzb24nKSkgIFxuICAgICAgICAgICAgLnRoZW4oICBcbiAgICAgICAgICAgICAgKHJlc3BvbnNlKT0+eyAgXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7ICBcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdMb29rcyBsaWtlIHRoZXJlIHdhcyBhIHByb2JsZW0uIFN0YXR1cyBDb2RlOiAnICsgIHJlc3BvbnNlLnN0YXR1cyk7ICBcbiAgICAgICAgICAgICAgICAgIHJldHVybjsgIFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNwb25zZS5qc29uKCkudGhlbigoZGF0YSk9PnsgIFxuICAgICAgICAgICAgICAgICAgbG9jYWxlcy5nbG9iYWwgPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2dsb2JhbCcpO1xuICAgICAgICAgICAgICAgIH0pOyAgXG4gICAgICAgICAgICAgIH0gIFxuICAgICAgICAgICAgKSAgXG4gICAgICAgICAgICAuY2F0Y2goKGVycik9PnsgIFxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRmV0Y2ggRXJyb3IgOi1TJywgZXJyKTsgIFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnZ2xvYmFsJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYodHlwZW9mIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdID09ICd1bmRlZmluZWQnKXtcbiAgICAgIFxuICAgICAgICAgICAgZmV0Y2godGhpcy5yZXNvbHZlVXJsKCcvc3JjL3RlbXBsYXRlLycrbGF5b3V0KycvbG9jYWxpemUuanNvbicpKSAgXG4gICAgICAgICAgICAudGhlbiggIFxuICAgICAgICAgICAgICAocmVzcG9uc2UpPT57ICBcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsgIFxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0xvb2tzIGxpa2UgdGhlcmUgd2FzIGEgcHJvYmxlbS4gU3RhdHVzIENvZGU6ICcgKyAgcmVzcG9uc2Uuc3RhdHVzKTsgIFxuICAgICAgICAgICAgICAgICAgcmV0dXJuOyAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKChkYXRhKT0+eyAgXG4gICAgICAgICAgICAgICAgICBsb2NhbGVzLmxheW91dHNbbGF5b3V0XSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnbGF5b3V0Jyk7XG4gICAgICAgICAgICAgICAgfSk7ICBcbiAgICAgICAgICAgICAgfSAgXG4gICAgICAgICAgICApICBcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyKT0+eyAgXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGZXRjaCBFcnJvciA6LVMnLCBlcnIpOyAgXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2xheW91dCcpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmKHR5cGVvZiBsb2NhbGVzLmFwcHNbYXBwXSA9PSAndW5kZWZpbmVkJyl7XG5cbiAgICAgICAgICAgIGZldGNoKHRoaXMucmVzb2x2ZVVybCgnL3NyYy9hcHBzLycrYXBwKycvbG9jYWxpemUuanNvbicpKSAgXG4gICAgICAgICAgICAudGhlbiggIFxuICAgICAgICAgICAgICAocmVzcG9uc2UpPT57ICBcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsgIFxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0xvb2tzIGxpa2UgdGhlcmUgd2FzIGEgcHJvYmxlbS4gU3RhdHVzIENvZGU6ICcgKyAgcmVzcG9uc2Uuc3RhdHVzKTsgIFxuICAgICAgICAgICAgICAgICAgcmV0dXJuOyAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKChkYXRhKT0+eyAgXG4gICAgICAgICAgICAgICAgICBsb2NhbGVzLmFwcHNbYXBwXSA9IGRhdGE7XG4gICAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdhcHAnKTtcbiAgICAgICAgICAgICAgICB9KTsgIFxuICAgICAgICAgICAgICB9ICBcbiAgICAgICAgICAgICkgIFxuICAgICAgICAgICAgLmNhdGNoKChlcnIpPT57ICBcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZldGNoIEVycm9yIDotUycsIGVycik7ICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2FwcCcpO1xuICAgICAgICAgIH1cblxuICAgICAgICB9XG5cblxuICAgICAgICBjaGVja1JvbGUoYXBwKXtcbiAgICAgICAgICB2YXIgcmVkaXJlY3QgPSB0cnVlO1xuICAgICAgICAgIHRoaXMucm9sZS5tYXAoKG9iaixpbmRleCk9PntcbiAgICAgICAgICAgIGlmKG9iai5wYXRoPT0oYXBwLmFwcCsnLycrYXBwLnBhZ2UpKXtcbiAgICAgICAgICAgICAgb2JqLnJvbGUubWFwKChzT2JqKT0+e1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuYXV0aC5yb2xlPT1zT2JqKXtcbiAgICAgICAgICAgICAgICAgIHJlZGlyZWN0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICByZWRpcmVjdCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcmV0dXJuIHJlZGlyZWN0O1xuICAgICAgICB9XG4gICAgICAgICAgXG5cbiAgICAgIH1cblxuICAgICAgUG9seW1lcihHbG9uU3lzdGVtKTtcblxuICAgIH0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
