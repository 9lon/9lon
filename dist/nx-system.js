"use strict";nxQuerySystem=document.querySelector("nx-system"),nxQueryLocalize={},Polymer({is:"nx-system",properties:{role:{type:Object,value:[{path:"app1/page1",role:["admin","manager","user1"]}]}},observers:["_routePageChanged(route)"],created:function(){"undefined"==typeof localStorage.nxLanguage&&localStorage.setItem("nxLanguage",initSystem.language);var a=jwt_decode("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiVXNlcjEiLCJyb2xlIjoiYWRtaW4ifQ.oRx_ieJoxSZPv7Y8lM03Qv8Qb24PVmuFpWBUxWEkBcg");this.auth=a},_routePageChanged:function(a){var e=this,t={};if("/"==a.path){var o=initSystem.indexPath.split("/");t={app:o[1],page:o[2]}}else t="undefined"==typeof a.path.split("/")[2]?{app:"error",page:"404"}:this.routeData;var l=function(){var a=document.createElement(t.app+"-"+t.page);a.route=t,e.getLocales(e.layout,t.app,function(o){if(mergeLocales=o,e.layout!=e.oldLayout)if("layout-main"!=initSystem.layout){var l=function(){var o=e.$$("tag-app-load");o.innerHTML="";var l=document.createElement(e.layout);l.route=t,l.page=a,o.appendChild(l)};e.importHref(e.resolveUrl("/src/template/"+e.layout+"/"+e.layout+".html"),function(a){l()},function(a){e.changePath("/error/404")},!0)}else l();else if("undefined"==typeof e.layout){var n=e.$$("tag-app-load");n.innerHTML="",n.appendChild(a)}else{var n=e.$$("tag-app-load>"+e.layout);n.route=t,n.page=a}e.oldLayout=e.layout})};this.checkRole(t)&&(t={app:"error",page:"403"}),this.importHref(this.resolveUrl("/src/apps/"+t.app+"/"+t.page+".html"),function(a){l()},function(a){t={app:"error",page:"404"},e.importHref(e.resolveUrl("/src/apps/"+t.app+"/"+t.page+".html"),function(a){l()},null,!0)},!0)},changePath:function(a){this.$.changePath.setAttribute("href",a),this.$.changePath.click()},getLocales:function(a,e,t){var o=function(){var o=JSON.parse(JSON.stringify(locales.global));if("undefined"!=typeof locales.layouts[a])for(var l in locales.layouts[a])for(var n in locales.layouts[a][l])o[l][n]=locales.layouts[a][l][n];for(var l in locales.apps[e])for(var n in locales.apps[e][l])o[l][n]=locales.apps[e][l][n];t(o)},l={global:!1,layout:!1,app:!1,loaded:function(a){this[a]=!0,this.global&&this.layout&&this.app&&o()}};"undefined"==typeof locales&&(locales={global:null,apps:{},layouts:{}}),null==locales.global?axios.get("/src/apps/localize.json").then(function(a){locales.global=a.data,l.loaded("global")}):l.loaded("global"),"undefined"==typeof locales.layouts[a]?axios.get("/src/template/"+a+"/localize.json").then(function(e){locales.layouts[a]=e.data,l.loaded("layout")}):l.loaded("layout"),"undefined"==typeof locales.apps[e]?axios.get("/src/apps/"+e+"/localize.json").then(function(a){locales.apps[e]=a.data,l.loaded("app")}):l.loaded("app")},checkRole:function(a){var e=this,t=!0;return this.role.map(function(o,l){o.path==a.app+"/"+a.page?o.role.map(function(a){e.auth.role==a&&(t=!1)}):t=!1}),t}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm54LXN5c3RlbS5qcyJdLCJuYW1lcyI6WyJueFF1ZXJ5U3lzdGVtIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibnhRdWVyeUxvY2FsaXplIiwiaXMiLCJQb2x5bWVyIiwicm9sZSIsInByb3BlcnRpZXMiLCJPYmplY3QiLCJ2YWx1ZSIsIm9ic2VydmVycyIsImxvY2FsU3RvcmFnZSIsIm54TGFuZ3VhZ2UiLCJzZXRJdGVtIiwiaW5pdFN5c3RlbSIsImxhbmd1YWdlIiwiZGVjb2RlZCIsImp3dF9kZWNvZGUiLCJfcm91dGVQYWdlQ2hhbmdlZCIsImdldFJvdXRlIiwiX3RoaXMiLCJ0aGlzIiwiaW5kZXhQYXRoIiwicm91dGVEYXRhIiwic3BsaXQiLCJwYWdlIiwiYXBwIiwicGF0aCIsImdldFBhZ2UiLCJyb3V0ZSIsImNyZWF0ZUVsZW1lbnQiLCJtZXJnZUxvY2FsZXMiLCJsYXlvdXQiLCJkYXRhIiwib2xkTGF5b3V0IiwicXVlcnlUYWciLCJpbm5lckhUTUwiLCIkJCIsImdldExheW91dCIsImFwcGVuZENoaWxkIiwicmVuZGVyTGF5b3V0IiwiY2hhbmdlUGF0aCIsImUiLCJjaGVja1JvbGUiLCJyZW5kZXJQYWdlIiwiY2xpY2siLCJnZXRMb2NhbGVzIiwibWVyZ2VEYXRhIiwicmVzb2x2ZVVybCIsImxvY2FsZXMiLCJrZXkiLCJjYWxsYmFjayIsInNldEF0dHJpYnV0ZSIsIiQiLCJsb2NhbGVzTG9hZGVkIiwibG9hZGVkIiwiSlNPTiIsInBvaW50ZXIiLCJzdHJpbmdpZnkiLCJnbG9iYWwiLCJsYXlvdXRzIiwia2V5MiIsImFwcHMiLCJyZXNwb25zZSIsImF4aW9zIiwiZ2V0Iiwib2JqIiwicmVkaXJlY3QiLCJ0aGVuIiwiX3RoaXMyIiwibWFwIiwiaW5kZXgiLCJzT2JqIiwiYXV0aCJdLCJtYXBwaW5ncyI6IllBQUFBLGVBQWdCQyxTQUFTQyxjQUFjLGFBQ25DQyxtQkFBQUEsU0FHRUMsR0FBRyxZQURMQyxZQUNLQyxNQUNIQyxLQUFXQyxPQUNK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bS5qcyIsInNvdXJjZXNDb250ZW50IjpbIm54UXVlcnlTeXN0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibngtc3lzdGVtXCIpO1xuICAgIG54UXVlcnlMb2NhbGl6ZSA9IHt9O1xuXG4gICAgUG9seW1lcih7XG4gICAgICBpczonbngtc3lzdGVtJyxcbiAgICAgIHByb3BlcnRpZXM6e1xuICAgICAgICByb2xlOntcbiAgICAgICAgICB0eXBlOk9iamVjdCxcbiAgICAgICAgICB2YWx1ZTpbXG4gICAgICAgICAgICB7IHBhdGg6J2FwcDEvcGFnZTEnLHJvbGU6WydhZG1pbicsJ21hbmFnZXInLCd1c2VyMSddfVxuICAgICAgICAgIF1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG9ic2VydmVyczogW1xuICAgICAgICAnX3JvdXRlUGFnZUNoYW5nZWQocm91dGUpJ1xuICAgICAgXSxjcmVhdGVkOmZ1bmN0aW9uKCl7XG4gICAgICAgIGlmKHR5cGVvZiBsb2NhbFN0b3JhZ2UubnhMYW5ndWFnZSA9PSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJueExhbmd1YWdlXCIsIGluaXRTeXN0ZW0ubGFuZ3VhZ2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGRlY29kZWQgPSBqd3RfZGVjb2RlKCdleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKMWMyVnlJam9pVlhObGNqRWlMQ0p5YjJ4bElqb2lZV1J0YVc0aWZRLm9SeF9pZUpveFNaUHY3WThsTTAzUXY4UWIyNFBWbXVGcFdCVXhXRWtCY2cnKTtcbiAgICAgICAgdGhpcy5hdXRoID0gZGVjb2RlZDtcbiAgICAgIH0sXG4gICAgICBfcm91dGVQYWdlQ2hhbmdlZDpmdW5jdGlvbihnZXRSb3V0ZSl7XG5cbiAgICAgICAgdmFyIHJvdXRlRGF0YSA9IHt9O1xuICAgICAgICBpZihnZXRSb3V0ZS5wYXRoID09IFwiL1wiKXtcbiAgICAgICAgICB2YXIgaW5kZXhQYXRoID0gaW5pdFN5c3RlbS5pbmRleFBhdGguc3BsaXQoJy8nKTtcbiAgICAgICAgICByb3V0ZURhdGEgPSB7IGFwcDppbmRleFBhdGhbMV0scGFnZTppbmRleFBhdGhbMl0gfTtcbiAgICAgICAgfWVsc2UgaWYodHlwZW9mIGdldFJvdXRlLnBhdGguc3BsaXQoJy8nKVsyXSA9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICByb3V0ZURhdGEgPSB7IGFwcDonZXJyb3InLHBhZ2U6JzQwNCcgfTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgcm91dGVEYXRhID0gdGhpcy5yb3V0ZURhdGE7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcmVuZGVyUGFnZSA9ICgpPT57XG4gICAgICAgICAgICAgIHZhciBnZXRQYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChyb3V0ZURhdGEuYXBwKyctJytyb3V0ZURhdGEucGFnZSk7XG4gICAgICAgICAgICAgIGdldFBhZ2Uucm91dGUgPSByb3V0ZURhdGE7XG5cbiAgICAgICAgICAgICAgdGhpcy5nZXRMb2NhbGVzKHRoaXMubGF5b3V0LHJvdXRlRGF0YS5hcHAsKGRhdGEpPT57XG4gICAgICAgICAgICAgICAgbWVyZ2VMb2NhbGVzID0gZGF0YTtcbiAgICAgICAgICAgICAgICBpZigodGhpcy5sYXlvdXQhPXRoaXMub2xkTGF5b3V0KSl7XG5cbiAgICAgICAgICAgICAgICAgIGlmKGluaXRTeXN0ZW0ubGF5b3V0IT1cImxheW91dC1tYWluXCIpe1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciByZW5kZXJMYXlvdXQgPSAoKT0+e1xuICAgICAgICAgICAgICAgICAgICAgIHZhciBxdWVyeVRhZyA9IHRoaXMuJCQoJ3RhZy1hcHAtbG9hZCcpO1xuICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLmlubmVySFRNTD0nJztcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgZ2V0TGF5b3V0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0aGlzLmxheW91dCk7XG4gICAgICAgICAgICAgICAgICAgICAgZ2V0TGF5b3V0LnJvdXRlID0gcm91dGVEYXRhO1xuICAgICAgICAgICAgICAgICAgICAgIGdldExheW91dC5wYWdlID0gZ2V0UGFnZTtcbiAgICAgICAgICAgICAgICAgICAgICBxdWVyeVRhZy5hcHBlbmRDaGlsZChnZXRMYXlvdXQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbXBvcnRIcmVmKFxuXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlVXJsKCcvc3JjL3RlbXBsYXRlLycrdGhpcy5sYXlvdXQrJy8nK3RoaXMubGF5b3V0KycuaHRtbCcpLFxuICAgICAgICAgICAgICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyTGF5b3V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAoZSk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlUGF0aCgnL2Vycm9yLzQwNCcpXG4gICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgIHRydWVcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlckxheW91dCgpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1lbHNlIGlmKHR5cGVvZiB0aGlzLmxheW91dCA9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICAgICAgICAgIHZhciBxdWVyeVRhZyA9IHRoaXMuJCQoJ3RhZy1hcHAtbG9hZCcpO1xuICAgICAgICAgICAgICAgICAgcXVlcnlUYWcuaW5uZXJIVE1MPScnO1xuICAgICAgICAgICAgICAgICAgcXVlcnlUYWcuYXBwZW5kQ2hpbGQoZ2V0UGFnZSk7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICB2YXIgcXVlcnlUYWcgPSB0aGlzLiQkKCd0YWctYXBwLWxvYWQ+Jyt0aGlzLmxheW91dCk7XG4gICAgICAgICAgICAgICAgICBxdWVyeVRhZy5yb3V0ZSA9IHJvdXRlRGF0YTtcbiAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLnBhZ2UgPSBnZXRQYWdlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMub2xkTGF5b3V0ID0gdGhpcy5sYXlvdXQ7XG5cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgaWYodGhpcy5jaGVja1JvbGUocm91dGVEYXRhKSl7XG4gICAgICAgICAgcm91dGVEYXRhID0geyBhcHA6J2Vycm9yJyxwYWdlOic0MDMnIH07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmltcG9ydEhyZWYoXG4gICAgICAgICAgdGhpcy5yZXNvbHZlVXJsKCcvc3JjL2FwcHMvJytyb3V0ZURhdGEuYXBwKycvJytyb3V0ZURhdGEucGFnZSsnLmh0bWwnKSxcbiAgICAgICAgICAoZSk9PntcbiAgICAgICAgICAgIHJlbmRlclBhZ2UoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICByb3V0ZURhdGEgPSB7IGFwcDonZXJyb3InLHBhZ2U6JzQwNCcgfTtcbiAgICAgICAgICAgICAgdGhpcy5pbXBvcnRIcmVmKFxuICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZVVybCgnL3NyYy9hcHBzLycrcm91dGVEYXRhLmFwcCsnLycrcm91dGVEYXRhLnBhZ2UrJy5odG1sJyksXG4gICAgICAgICAgICAgICAgKGUpPT57XG4gICAgICAgICAgICAgICAgICByZW5kZXJQYWdlKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgIHRydWVcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRydWVcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgXG4gICAgICB9LFxuICAgICAgY2hhbmdlUGF0aDpmdW5jdGlvbihwYXRoKXtcbiAgICAgICAgIHRoaXMuJC5jaGFuZ2VQYXRoLnNldEF0dHJpYnV0ZShcImhyZWZcIiwgcGF0aCk7XG4gICAgICAgICB0aGlzLiQuY2hhbmdlUGF0aC5jbGljaygpO1xuICAgICAgfSxcbiAgICAgIGdldExvY2FsZXM6ZnVuY3Rpb24obGF5b3V0LGFwcCxjYWxsYmFjayl7XG5cbiAgICAgICAgdmFyIG1lcmdlTG9jYWxlcyA9ICgpID0+IHtcbiAgICAgICAgICBcbiAgICAgICAgICB2YXIgbWVyZ2VEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShsb2NhbGVzLmdsb2JhbCkpO1xuICAgICBcblxuICAgICAgICAgIGlmKHR5cGVvZiBsb2NhbGVzLmxheW91dHNbbGF5b3V0XSAhPSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICAgIGZvcih2YXIga2V5IGluIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdKSB7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBrZXkyIGluIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdW2tleV0pIHtcbiAgICAgICAgICAgICAgICAgIG1lcmdlRGF0YVtrZXldW2tleTJdID0gbG9jYWxlcy5sYXlvdXRzW2xheW91dF1ba2V5XVtrZXkyXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBcblxuICAgICAgICAgIGZvcih2YXIga2V5IGluIGxvY2FsZXMuYXBwc1thcHBdKSB7XG4gICAgICAgICAgICAgIGZvcih2YXIga2V5MiBpbiBsb2NhbGVzLmFwcHNbYXBwXVtrZXldKSB7XG4gICAgICAgICAgICAgICAgbWVyZ2VEYXRhW2tleV1ba2V5Ml0gPSBsb2NhbGVzLmFwcHNbYXBwXVtrZXldW2tleTJdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhbGxiYWNrKG1lcmdlRGF0YSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsb2NhbGVzTG9hZGVkID0ge1xuICAgICAgICAgIGdsb2JhbDpmYWxzZSxcbiAgICAgICAgICBsYXlvdXQ6ZmFsc2UsXG4gICAgICAgICAgYXBwOmZhbHNlLFxuICAgICAgICAgIGxvYWRlZDpmdW5jdGlvbiAocG9pbnRlcikge1xuICAgICAgICAgICAgdGhpc1twb2ludGVyXSA9IHRydWU7XG4gICAgICAgICAgICBpZih0aGlzLmdsb2JhbCYmdGhpcy5sYXlvdXQmJnRoaXMuYXBwKXtcbiAgICAgICAgICAgICAgbWVyZ2VMb2NhbGVzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cblxuICAgICAgICBpZih0eXBlb2YgbG9jYWxlcyA9PSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgbG9jYWxlcyA9IHtnbG9iYWw6bnVsbCxhcHBzOnt9LGxheW91dHM6e319O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYobG9jYWxlcy5nbG9iYWw9PW51bGwpe1xuICAgICAgICAgIGF4aW9zLmdldCgnL3NyYy9hcHBzL2xvY2FsaXplLmpzb24nKVxuICAgICAgICAgIC50aGVuKChyZXNwb25zZSk9PntcbiAgICAgICAgICAgIGxvY2FsZXMuZ2xvYmFsID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdnbG9iYWwnKTtcbiAgICAgICAgICB9KVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnZ2xvYmFsJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZih0eXBlb2YgbG9jYWxlcy5sYXlvdXRzW2xheW91dF0gPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgIGF4aW9zLmdldCgnL3NyYy90ZW1wbGF0ZS8nK2xheW91dCsnL2xvY2FsaXplLmpzb24nKVxuICAgICAgICAgIC50aGVuKChyZXNwb25zZSk9PntcbiAgICAgICAgICAgIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdsYXlvdXQnKTtcbiAgICAgICAgICB9KVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnbGF5b3V0Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZih0eXBlb2YgbG9jYWxlcy5hcHBzW2FwcF0gPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgIGF4aW9zLmdldCgnL3NyYy9hcHBzLycrYXBwKycvbG9jYWxpemUuanNvbicpXG4gICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKT0+e1xuICAgICAgICAgICAgbG9jYWxlcy5hcHBzW2FwcF0gPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2FwcCcpO1xuICAgICAgICAgIH0pXG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdhcHAnKTtcbiAgICAgICAgfVxuXG4gICAgICB9LFxuICAgICAgY2hlY2tSb2xlOmZ1bmN0aW9uKGFwcCl7XG4gICAgICAgIHZhciByZWRpcmVjdCA9IHRydWU7XG4gICAgICAgIHRoaXMucm9sZS5tYXAoKG9iaixpbmRleCk9PntcbiAgICAgICAgICBpZihvYmoucGF0aD09KGFwcC5hcHArJy8nK2FwcC5wYWdlKSl7XG4gICAgICAgICAgICBvYmoucm9sZS5tYXAoKHNPYmopPT57XG4gICAgICAgICAgICAgIGlmKHRoaXMuYXV0aC5yb2xlPT1zT2JqKXtcbiAgICAgICAgICAgICAgICByZWRpcmVjdCA9IGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHJlZGlyZWN0ID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gcmVkaXJlY3Q7XG4gICAgICB9XG4gICAgfSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
