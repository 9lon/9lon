"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var o=a[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(a,t,o){return t&&e(a.prototype,t),o&&e(a,o),a}}();!function(){window.nxQuerySystem=document.querySelector("nx-system"),window.nxQueryLocalize={};var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"beforeRegister",value:function(){this.is="nx-system",this.properties={role:{type:Object,value:[{path:"app1/page1",role:["admin","manager","user1"]}]}}}},{key:"created",value:function(){"undefined"==typeof localStorage.nxLanguage&&localStorage.setItem("nxLanguage",initSystem.language);var e=jwt_decode("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiVXNlcjEiLCJyb2xlIjoiYWRtaW4ifQ.oRx_ieJoxSZPv7Y8lM03Qv8Qb24PVmuFpWBUxWEkBcg");this.auth=e}},{key:"_routePageChanged",value:function(e){var a=this,t={};if("/"==e.path){var o=initSystem.indexPath.split("/");t={app:o[1],page:o[2]}}else t="undefined"==typeof e.path.split("/")[2]?{app:"error",page:"404"}:this.routeData;var l=function(){var e=document.createElement(t.app+"-"+t.page);e.route=t,a.getLocales(a.layout,t.app,function(o){if(window.mergeLocales=o,a.layout!=a.oldLayout){var l=function(){var o=a.$$("tag-app-load");o.innerHTML="";var l=document.createElement(a.layout);l.route=t,l.page=e,o.appendChild(l)};initSystem.layout!=a.layout?a.importHref(a.resolveUrl("/src/template/"+a.layout+"/"+a.layout+".html"),function(e){l()},function(e){a.changePath("/error/404")},!0):l()}else if("undefined"==typeof a.layout){var n=a.$$("tag-app-load");n.innerHTML="",n.appendChild(e)}else{var n=a.$$("tag-app-load>"+a.layout);n.route=t,n.page=e}a.oldLayout=a.layout})};this.checkRole(t)&&(t={app:"error",page:"403"}),this.importHref(this.resolveUrl("/src/apps/"+t.app+"/"+t.page+".html"),function(e){l()},function(e){t={app:"error",page:"404"},a.importHref(a.resolveUrl("/src/apps/"+t.app+"/"+t.page+".html"),function(e){l()},null,!0)},!0)}},{key:"changePath",value:function(e){this.$.changePath.setAttribute("href",e),this.$.changePath.click()}},{key:"getLocales",value:function(e,a,t){var o=function(){var o=JSON.parse(JSON.stringify(locales.global));if("undefined"!=typeof locales.layouts[e])for(var l in locales.layouts[e])for(var n in locales.layouts[e][l])o[l][n]=locales.layouts[e][l][n];for(var l in locales.apps[a])for(var n in locales.apps[a][l])o[l][n]=locales.apps[a][l][n];t(o)},l={global:!1,layout:!1,app:!1,loaded:function(e){this[e]=!0,this.global&&this.layout&&this.app&&o()}};"undefined"==typeof locales&&(window.locales={global:null,apps:{},layouts:{}}),null==locales.global?axios.get("/src/apps/localize.json").then(function(e){locales.global=e.data,l.loaded("global")}):l.loaded("global"),"undefined"==typeof locales.layouts[e]?axios.get("/src/template/"+e+"/localize.json").then(function(a){locales.layouts[e]=a.data,l.loaded("layout")}):l.loaded("layout"),"undefined"==typeof locales.apps[a]?axios.get("/src/apps/"+a+"/localize.json").then(function(e){locales.apps[a]=e.data,l.loaded("app")}):l.loaded("app")}},{key:"checkRole",value:function(e){var a=this,t=!0;return this.role.map(function(o,l){o.path==e.app+"/"+e.page?o.role.map(function(e){a.auth.role==e&&(t=!1)}):t=!1}),t}},{key:"observers",get:function(){return["_routePageChanged(route)"]}}]),e}();Polymer(e)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm54LXN5c3RlbS5qcyJdLCJuYW1lcyI6WyJ3aW5kb3ciLCJueFF1ZXJ5U3lzdGVtIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibnhRdWVyeUxvY2FsaXplIiwiTnhTeXN0ZW0iLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiX2NyZWF0ZUNsYXNzIiwia2V5IiwidmFsdWUiLCJpcyIsInByb3BlcnRpZXMiLCJyb2xlIiwidHlwZSIsIk9iamVjdCIsInBhdGgiLCJsb2NhbFN0b3JhZ2UiLCJueExhbmd1YWdlIiwic2V0SXRlbSIsImluaXRTeXN0ZW0iLCJsYW5ndWFnZSIsImRlY29kZWQiLCJqd3RfZGVjb2RlIiwiX3RoaXMiLCJyb3V0ZURhdGEiLCJnZXRSb3V0ZSIsImluZGV4UGF0aCIsInNwbGl0IiwiYXBwIiwicGFnZSIsInJlbmRlclBhZ2UiLCJnZXRQYWdlIiwicm91dGUiLCJnZXRMb2NhbGVzIiwibGF5b3V0IiwiZGF0YSIsIm1lcmdlTG9jYWxlcyIsInJlbmRlckxheW91dCIsInF1ZXJ5VGFnIiwiJCQiLCJpbm5lckhUTUwiLCJjcmVhdGVFbGVtZW50Iiwib2xkTGF5b3V0IiwiZ2V0TGF5b3V0IiwiYXBwZW5kQ2hpbGQiLCJyZXNvbHZlVXJsIiwiY2hhbmdlUGF0aCIsImltcG9ydEhyZWYiLCJlIiwic2V0QXR0cmlidXRlIiwiJCIsImNsaWNrIiwibWVyZ2VEYXRhIiwia2V5MiIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsImxvY2FsZXMiLCJnbG9iYWwiLCJsYXlvdXRzIiwicG9pbnRlciIsImFwcHMiLCJjYWxsYmFjayIsImxvY2FsZXNMb2FkZWQiLCJsb2FkZWQiLCJheGlvcyIsInJlc3BvbnNlIiwiZ2V0IiwidGhlbiIsInJlZGlyZWN0IiwiYXV0aCIsIl90aGlzMiIsIm1hcCIsIm9iaiIsImluZGV4Iiwic09iaiIsIlBvbHltZXIiXSwibWFwcGluZ3MiOiI4WEFBQSxXQUdNQSxPQUFPQyxjQUFnQkMsU0FBU0MsY0FBYyxhQUM5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QUEsR0FBQTJDLEdBQUFqRSxLQThNRStELEdBQVcsQ0FhZixPQTNORS9ELE1BQUFNLEtBQUE0RCxJQUFBLFNBQUFDLEVBQUFDLEdBQUFELEVBQUExRCxNQUFBYSxFQUFBQSxJQUFBLElBQUFBLEVBQUFDLEtBaU5FNEMsRUFBSTdELEtBQUs0RCxJQUFJLFNBQUNHLEdBZ0J0QkosRUFBQUQsS0FBQTFELE1BQUErRCxJQWpPTk4sR0FBQSxLQXVOY0EsR0FBVyxJQUlSQSxLQTNOTDdELElBQUEsWUFBQTJELElBQUEsV0FHQ25FLE9BQ0FHLGdDQUpEQyxJQWlPTndFLFNBQVF4RSIsImZpbGUiOiJueC1zeXN0ZW0uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG4gICAgICAndXNlIHN0cmljdCc7XG5cbiAgICAgIHdpbmRvdy5ueFF1ZXJ5U3lzdGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIm54LXN5c3RlbVwiKTtcbiAgICAgIHdpbmRvdy5ueFF1ZXJ5TG9jYWxpemUgPSB7fTtcblxuICAgICAgY2xhc3MgTnhTeXN0ZW0ge1xuXG4gICAgICAgIGdldCBvYnNlcnZlcnMoKSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICdfcm91dGVQYWdlQ2hhbmdlZChyb3V0ZSknXG4gICAgICAgICAgXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJlZm9yZVJlZ2lzdGVyKCkge1xuICAgICAgICAgIHRoaXMuaXMgPSAnbngtc3lzdGVtJztcbiAgICAgICAgICB0aGlzLnByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgICByb2xlOntcbiAgICAgICAgICAgICAgdHlwZTpPYmplY3QsXG4gICAgICAgICAgICAgIHZhbHVlOltcbiAgICAgICAgICAgICAgICB7IHBhdGg6J2FwcDEvcGFnZTEnLHJvbGU6WydhZG1pbicsJ21hbmFnZXInLCd1c2VyMSddfVxuICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNyZWF0ZWQoKXtcbiAgICAgICAgICBpZih0eXBlb2YgbG9jYWxTdG9yYWdlLm54TGFuZ3VhZ2UgPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJueExhbmd1YWdlXCIsIGluaXRTeXN0ZW0ubGFuZ3VhZ2UpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciBkZWNvZGVkID0gand0X2RlY29kZSgnZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SjFjMlZ5SWpvaVZYTmxjakVpTENKeWIyeGxJam9pWVdSdGFXNGlmUS5vUnhfaWVKb3hTWlB2N1k4bE0wM1F2OFFiMjRQVm11RnBXQlV4V0VrQmNnJyk7XG4gICAgICAgICAgdGhpcy5hdXRoID0gZGVjb2RlZDtcbiAgICAgICAgfVxuXG4gICAgICAgIF9yb3V0ZVBhZ2VDaGFuZ2VkKGdldFJvdXRlKXtcblxuICAgICAgICAgIHZhciByb3V0ZURhdGEgPSB7fTtcbiAgICAgICAgICBpZihnZXRSb3V0ZS5wYXRoID09IFwiL1wiKXtcbiAgICAgICAgICAgIHZhciBpbmRleFBhdGggPSBpbml0U3lzdGVtLmluZGV4UGF0aC5zcGxpdCgnLycpO1xuICAgICAgICAgICAgcm91dGVEYXRhID0geyBhcHA6aW5kZXhQYXRoWzFdLHBhZ2U6aW5kZXhQYXRoWzJdIH07XG4gICAgICAgICAgfWVsc2UgaWYodHlwZW9mIGdldFJvdXRlLnBhdGguc3BsaXQoJy8nKVsyXSA9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICAgIHJvdXRlRGF0YSA9IHsgYXBwOidlcnJvcicscGFnZTonNDA0JyB9O1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgcm91dGVEYXRhID0gdGhpcy5yb3V0ZURhdGE7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIHJlbmRlclBhZ2UgPSAoKT0+e1xuICAgICAgICAgICAgICAgIHZhciBnZXRQYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChyb3V0ZURhdGEuYXBwKyctJytyb3V0ZURhdGEucGFnZSk7XG4gICAgICAgICAgICAgICAgZ2V0UGFnZS5yb3V0ZSA9IHJvdXRlRGF0YTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0TG9jYWxlcyh0aGlzLmxheW91dCxyb3V0ZURhdGEuYXBwLChkYXRhKT0+e1xuICAgICAgICAgICAgICAgICAgd2luZG93Lm1lcmdlTG9jYWxlcyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgICBpZigodGhpcy5sYXlvdXQhPXRoaXMub2xkTGF5b3V0KSl7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlbmRlckxheW91dCA9ICgpPT57XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5VGFnID0gdGhpcy4kJCgndGFnLWFwcC1sb2FkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcuaW5uZXJIVE1MPScnO1xuICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRMYXlvdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRoaXMubGF5b3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICBnZXRMYXlvdXQucm91dGUgPSByb3V0ZURhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgZ2V0TGF5b3V0LnBhZ2UgPSBnZXRQYWdlO1xuICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLmFwcGVuZENoaWxkKGdldExheW91dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZihpbml0U3lzdGVtLmxheW91dCE9dGhpcy5sYXlvdXQpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbXBvcnRIcmVmKFxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc29sdmVVcmwoJy9zcmMvdGVtcGxhdGUvJyt0aGlzLmxheW91dCsnLycrdGhpcy5sYXlvdXQrJy5odG1sJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAoZSk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyTGF5b3V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgKGUpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlUGF0aCgnL2Vycm9yLzQwNCcpXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICByZW5kZXJMYXlvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mIHRoaXMubGF5b3V0ID09IFwidW5kZWZpbmVkXCIpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnlUYWcgPSB0aGlzLiQkKCd0YWctYXBwLWxvYWQnKTtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcuaW5uZXJIVE1MPScnO1xuICAgICAgICAgICAgICAgICAgICBxdWVyeVRhZy5hcHBlbmRDaGlsZChnZXRQYWdlKTtcbiAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnlUYWcgPSB0aGlzLiQkKCd0YWctYXBwLWxvYWQ+Jyt0aGlzLmxheW91dCk7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLnJvdXRlID0gcm91dGVEYXRhO1xuICAgICAgICAgICAgICAgICAgICBxdWVyeVRhZy5wYWdlID0gZ2V0UGFnZTtcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgdGhpcy5vbGRMYXlvdXQgPSB0aGlzLmxheW91dDtcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgIGlmKHRoaXMuY2hlY2tSb2xlKHJvdXRlRGF0YSkpe1xuICAgICAgICAgICAgcm91dGVEYXRhID0geyBhcHA6J2Vycm9yJyxwYWdlOic0MDMnIH07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5pbXBvcnRIcmVmKFxuICAgICAgICAgICAgdGhpcy5yZXNvbHZlVXJsKCcvc3JjL2FwcHMvJytyb3V0ZURhdGEuYXBwKycvJytyb3V0ZURhdGEucGFnZSsnLmh0bWwnKSxcbiAgICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICByZW5kZXJQYWdlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGUpPT57XG4gICAgICAgICAgICAgICAgcm91dGVEYXRhID0geyBhcHA6J2Vycm9yJyxwYWdlOic0MDQnIH07XG4gICAgICAgICAgICAgICAgdGhpcy5pbXBvcnRIcmVmKFxuICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlVXJsKCcvc3JjL2FwcHMvJytyb3V0ZURhdGEuYXBwKycvJytyb3V0ZURhdGEucGFnZSsnLmh0bWwnKSxcbiAgICAgICAgICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJQYWdlKCk7XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICAgIHRydWVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgICApO1xuICAgICAgICAgIFxuICAgICAgICBcbiAgICAgICAgfVxuXG5cbiAgICAgICAgY2hhbmdlUGF0aChwYXRoKXtcbiAgICAgICAgICB0aGlzLiQuY2hhbmdlUGF0aC5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsIHBhdGgpO1xuICAgICAgICAgIHRoaXMuJC5jaGFuZ2VQYXRoLmNsaWNrKCk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGdldExvY2FsZXMobGF5b3V0LGFwcCxjYWxsYmFjayl7XG5cbiAgICAgICAgICB2YXIgbWVyZ2VMb2NhbGVzID0gKCkgPT4ge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgbWVyZ2VEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShsb2NhbGVzLmdsb2JhbCkpO1xuICAgICAgXG5cbiAgICAgICAgICAgIGlmKHR5cGVvZiBsb2NhbGVzLmxheW91dHNbbGF5b3V0XSAhPSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICAgICAgZm9yKHZhciBrZXkgaW4gbG9jYWxlcy5sYXlvdXRzW2xheW91dF0pIHtcbiAgICAgICAgICAgICAgICAgIGZvcih2YXIga2V5MiBpbiBsb2NhbGVzLmxheW91dHNbbGF5b3V0XVtrZXldKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lcmdlRGF0YVtrZXldW2tleTJdID0gbG9jYWxlcy5sYXlvdXRzW2xheW91dF1ba2V5XVtrZXkyXTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBcblxuICAgICAgICAgICAgZm9yKHZhciBrZXkgaW4gbG9jYWxlcy5hcHBzW2FwcF0pIHtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGtleTIgaW4gbG9jYWxlcy5hcHBzW2FwcF1ba2V5XSkge1xuICAgICAgICAgICAgICAgICAgbWVyZ2VEYXRhW2tleV1ba2V5Ml0gPSBsb2NhbGVzLmFwcHNbYXBwXVtrZXldW2tleTJdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxiYWNrKG1lcmdlRGF0YSk7XG5cbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgbG9jYWxlc0xvYWRlZCA9IHtcbiAgICAgICAgICAgIGdsb2JhbDpmYWxzZSxcbiAgICAgICAgICAgIGxheW91dDpmYWxzZSxcbiAgICAgICAgICAgIGFwcDpmYWxzZSxcbiAgICAgICAgICAgIGxvYWRlZDpmdW5jdGlvbiAocG9pbnRlcikge1xuICAgICAgICAgICAgICB0aGlzW3BvaW50ZXJdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgaWYodGhpcy5nbG9iYWwmJnRoaXMubGF5b3V0JiZ0aGlzLmFwcCl7XG4gICAgICAgICAgICAgICAgbWVyZ2VMb2NhbGVzKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cblxuICAgICAgICAgIGlmKHR5cGVvZiBsb2NhbGVzID09ICd1bmRlZmluZWQnKXtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbGVzID0ge2dsb2JhbDpudWxsLGFwcHM6e30sbGF5b3V0czp7fX07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYobG9jYWxlcy5nbG9iYWw9PW51bGwpe1xuICAgICAgICAgICAgYXhpb3MuZ2V0KCcvc3JjL2FwcHMvbG9jYWxpemUuanNvbicpXG4gICAgICAgICAgICAudGhlbigocmVzcG9uc2UpPT57XG4gICAgICAgICAgICAgIGxvY2FsZXMuZ2xvYmFsID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2dsb2JhbCcpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdnbG9iYWwnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZih0eXBlb2YgbG9jYWxlcy5sYXlvdXRzW2xheW91dF0gPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgICAgYXhpb3MuZ2V0KCcvc3JjL3RlbXBsYXRlLycrbGF5b3V0KycvbG9jYWxpemUuanNvbicpXG4gICAgICAgICAgICAudGhlbigocmVzcG9uc2UpPT57XG4gICAgICAgICAgICAgIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2xheW91dCcpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdsYXlvdXQnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZih0eXBlb2YgbG9jYWxlcy5hcHBzW2FwcF0gPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgICAgYXhpb3MuZ2V0KCcvc3JjL2FwcHMvJythcHArJy9sb2NhbGl6ZS5qc29uJylcbiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSk9PntcbiAgICAgICAgICAgICAgbG9jYWxlcy5hcHBzW2FwcF0gPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnYXBwJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2FwcCcpO1xuICAgICAgICAgIH1cblxuICAgICAgICB9XG5cblxuICAgICAgICBjaGVja1JvbGUoYXBwKXtcbiAgICAgICAgICB2YXIgcmVkaXJlY3QgPSB0cnVlO1xuICAgICAgICAgIHRoaXMucm9sZS5tYXAoKG9iaixpbmRleCk9PntcbiAgICAgICAgICAgIGlmKG9iai5wYXRoPT0oYXBwLmFwcCsnLycrYXBwLnBhZ2UpKXtcbiAgICAgICAgICAgICAgb2JqLnJvbGUubWFwKChzT2JqKT0+e1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuYXV0aC5yb2xlPT1zT2JqKXtcbiAgICAgICAgICAgICAgICAgIHJlZGlyZWN0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICByZWRpcmVjdCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcmV0dXJuIHJlZGlyZWN0O1xuICAgICAgICB9XG4gICAgICAgICAgXG5cbiAgICAgIH1cblxuICAgICAgUG9seW1lcihOeFN5c3RlbSk7XG5cbiAgICB9KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
