"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var o=a[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(a,t,o){return t&&e(a.prototype,t),o&&e(a,o),a}}();!function(){window.nxQuerySystem=document.querySelector("nx-system"),window.nxQueryLocalize={},window.gl={};var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"beforeRegister",value:function(){this.is="nx-system",this.properties={role:{type:Object,value:[{path:"app1/page1",role:["admin","manager","user1"]}]}}}},{key:"created",value:function(){"undefined"==typeof localStorage.nxLanguage&&localStorage.setItem("nxLanguage",initSystem.language);var e=jwt_decode("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiVXNlcjEiLCJyb2xlIjoiYWRtaW4ifQ.oRx_ieJoxSZPv7Y8lM03Qv8Qb24PVmuFpWBUxWEkBcg");this.auth=e}},{key:"_routePageChanged",value:function(e){var a=this,t={};if("/"==e.path){var o=initSystem.indexPath.split("/");t={app:o[1],page:o[2]}}else t="undefined"==typeof e.path.split("/")[2]?{app:"error",page:"404"}:this.routeData;var l=function(){var e=document.createElement(t.app+"-"+t.page);e.route=t,a.getLocales(a.layout,t.app,function(o){if(window.mergeLocales=o,a.layout!=a.oldLayout){var l=function(){var o=a.$$("tag-app-load");o.innerHTML="";var l=document.createElement(a.layout);l.route=t,l.page=e,o.appendChild(l)};initSystem.layout!=a.layout?a.importHref(a.resolveUrl("/src/template/"+a.layout+"/"+a.layout+".html"),function(e){l()},function(e){a.changePath("/error/404")},!0):l()}else if("undefined"==typeof a.layout){var n=a.$$("tag-app-load");n.innerHTML="",n.appendChild(e)}else{var n=a.$$("tag-app-load>"+a.layout);n.route=t,n.page=e}a.oldLayout=a.layout})};this.checkRole(t)&&(t={app:"error",page:"403"}),this.importHref(this.resolveUrl("/src/apps/"+t.app+"/"+t.page+".html"),function(e){l()},function(e){t={app:"error",page:"404"},a.importHref(a.resolveUrl("/src/apps/"+t.app+"/"+t.page+".html"),function(e){l()},null,!0)},!0)}},{key:"changePath",value:function(e){this.$.changePath.setAttribute("href",e),this.$.changePath.click()}},{key:"getLocales",value:function(e,a,t){var o=function(){var o=JSON.parse(JSON.stringify(locales.global));if("undefined"!=typeof locales.layouts[e])for(var l in locales.layouts[e])for(var n in locales.layouts[e][l])o[l][n]=locales.layouts[e][l][n];for(var l in locales.apps[a])for(var n in locales.apps[a][l])o[l][n]=locales.apps[a][l][n];t(o)},l={global:!1,layout:!1,app:!1,loaded:function(e){this[e]=!0,this.global&&this.layout&&this.app&&o()}};"undefined"==typeof locales&&(window.locales={global:null,apps:{},layouts:{}}),null==locales.global?axios.get("/src/apps/localize.json").then(function(e){locales.global=e.data,l.loaded("global")}):l.loaded("global"),"undefined"==typeof locales.layouts[e]?axios.get("/src/template/"+e+"/localize.json").then(function(a){locales.layouts[e]=a.data,l.loaded("layout")}):l.loaded("layout"),"undefined"==typeof locales.apps[a]?axios.get("/src/apps/"+a+"/localize.json").then(function(e){locales.apps[a]=e.data,l.loaded("app")}):l.loaded("app")}},{key:"checkRole",value:function(e){var a=this,t=!0;return this.role.map(function(o,l){o.path==e.app+"/"+e.page?o.role.map(function(e){a.auth.role==e&&(t=!1)}):t=!1}),t}},{key:"observers",get:function(){return["_routePageChanged(route)"]}}]),e}();Polymer(e)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm54LXN5c3RlbS5qcyJdLCJuYW1lcyI6WyJ3aW5kb3ciLCJueFF1ZXJ5U3lzdGVtIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibnhRdWVyeUxvY2FsaXplIiwiZ2wiLCJOeFN5c3RlbSIsIl9jbGFzc0NhbGxDaGVjayIsInRoaXMiLCJfY3JlYXRlQ2xhc3MiLCJrZXkiLCJ2YWx1ZSIsImlzIiwicHJvcGVydGllcyIsInJvbGUiLCJ0eXBlIiwiT2JqZWN0IiwicGF0aCIsImxvY2FsU3RvcmFnZSIsIm54TGFuZ3VhZ2UiLCJzZXRJdGVtIiwiaW5pdFN5c3RlbSIsImxhbmd1YWdlIiwiZGVjb2RlZCIsImp3dF9kZWNvZGUiLCJfdGhpcyIsInJvdXRlRGF0YSIsImdldFJvdXRlIiwiaW5kZXhQYXRoIiwic3BsaXQiLCJhcHAiLCJwYWdlIiwicmVuZGVyUGFnZSIsImdldFBhZ2UiLCJyb3V0ZSIsImdldExvY2FsZXMiLCJsYXlvdXQiLCJkYXRhIiwibWVyZ2VMb2NhbGVzIiwicmVuZGVyTGF5b3V0IiwicXVlcnlUYWciLCIkJCIsImlubmVySFRNTCIsImNyZWF0ZUVsZW1lbnQiLCJvbGRMYXlvdXQiLCJnZXRMYXlvdXQiLCJhcHBlbmRDaGlsZCIsInJlc29sdmVVcmwiLCJjaGFuZ2VQYXRoIiwiaW1wb3J0SHJlZiIsImUiLCJzZXRBdHRyaWJ1dGUiLCIkIiwiY2xpY2siLCJtZXJnZURhdGEiLCJrZXkyIiwiSlNPTiIsInBhcnNlIiwic3RyaW5naWZ5IiwibG9jYWxlcyIsImdsb2JhbCIsImxheW91dHMiLCJwb2ludGVyIiwiYXBwcyIsImNhbGxiYWNrIiwibG9jYWxlc0xvYWRlZCIsImxvYWRlZCIsImF4aW9zIiwicmVzcG9uc2UiLCJnZXQiLCJ0aGVuIiwicmVkaXJlY3QiLCJhdXRoIiwiX3RoaXMyIiwibWFwIiwib2JqIiwiaW5kZXgiLCJzT2JqIiwiUG9seW1lciJdLCJtYXBwaW5ncyI6IjhYQUFBLFdBR01BLE9BQU9DLGNBQWdCQyxTQUFTQyxjQUFj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QUFBQyxNQUFBLFNBQUFtQixHQUFBLEdBQUEyQyxHQUFBakUsS0ErTUUrRCxHQUFXLENBYWYsT0E1TkUvRCxNQUFBTSxLQUFBNEQsSUFBQSxTQUFBQyxFQUFBQyxHQUFBRCxFQUFBMUQsTUFBQWEsRUFBQUEsSUFBQSxJQUFBQSxFQUFBQyxLQWtORTRDLEVBQUk3RCxLQUFLNEQsSUFBSSxTQUFDRyxHQWdCdEJKLEVBQUFELEtBQUExRCxNQUFBK0QsSUFsT05OLEdBQUEsS0F3TmNBLEdBQVcsSUFJUkEsS0E1Tkw3RCxJQUFBLFlBQUEyRCxJQUFBLFdBSUNqRSxPQUNQLGdDQUxNRSxJQWtPTndFLFNBQVF4RSIsImZpbGUiOiJueC1zeXN0ZW0uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG4gICAgICAndXNlIHN0cmljdCc7XG4gICAgICBcbiAgICAgIHdpbmRvdy5ueFF1ZXJ5U3lzdGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIm54LXN5c3RlbVwiKTtcbiAgICAgIHdpbmRvdy5ueFF1ZXJ5TG9jYWxpemUgPSB7fTtcbiAgICAgIHdpbmRvdy5nbCA9IHt9O1xuXG4gICAgICBjbGFzcyBOeFN5c3RlbSB7XG5cbiAgICAgICAgZ2V0IG9ic2VydmVycygpIHtcbiAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgJ19yb3V0ZVBhZ2VDaGFuZ2VkKHJvdXRlKSdcbiAgICAgICAgICBdO1xuICAgICAgICB9XG5cbiAgICAgICAgYmVmb3JlUmVnaXN0ZXIoKSB7XG4gICAgICAgICAgdGhpcy5pcyA9ICdueC1zeXN0ZW0nO1xuICAgICAgICAgIHRoaXMucHJvcGVydGllcyA9IHtcbiAgICAgICAgICAgIHJvbGU6e1xuICAgICAgICAgICAgICB0eXBlOk9iamVjdCxcbiAgICAgICAgICAgICAgdmFsdWU6W1xuICAgICAgICAgICAgICAgIHsgcGF0aDonYXBwMS9wYWdlMScscm9sZTpbJ2FkbWluJywnbWFuYWdlcicsJ3VzZXIxJ119XG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY3JlYXRlZCgpe1xuICAgICAgICAgIGlmKHR5cGVvZiBsb2NhbFN0b3JhZ2UubnhMYW5ndWFnZSA9PSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcIm54TGFuZ3VhZ2VcIiwgaW5pdFN5c3RlbS5sYW5ndWFnZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGRlY29kZWQgPSBqd3RfZGVjb2RlKCdleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKMWMyVnlJam9pVlhObGNqRWlMQ0p5YjJ4bElqb2lZV1J0YVc0aWZRLm9SeF9pZUpveFNaUHY3WThsTTAzUXY4UWIyNFBWbXVGcFdCVXhXRWtCY2cnKTtcbiAgICAgICAgICB0aGlzLmF1dGggPSBkZWNvZGVkO1xuICAgICAgICB9XG5cbiAgICAgICAgX3JvdXRlUGFnZUNoYW5nZWQoZ2V0Um91dGUpe1xuXG4gICAgICAgICAgdmFyIHJvdXRlRGF0YSA9IHt9O1xuICAgICAgICAgIGlmKGdldFJvdXRlLnBhdGggPT0gXCIvXCIpe1xuICAgICAgICAgICAgdmFyIGluZGV4UGF0aCA9IGluaXRTeXN0ZW0uaW5kZXhQYXRoLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICByb3V0ZURhdGEgPSB7IGFwcDppbmRleFBhdGhbMV0scGFnZTppbmRleFBhdGhbMl0gfTtcbiAgICAgICAgICB9ZWxzZSBpZih0eXBlb2YgZ2V0Um91dGUucGF0aC5zcGxpdCgnLycpWzJdID09IFwidW5kZWZpbmVkXCIpe1xuICAgICAgICAgICAgcm91dGVEYXRhID0geyBhcHA6J2Vycm9yJyxwYWdlOic0MDQnIH07XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICByb3V0ZURhdGEgPSB0aGlzLnJvdXRlRGF0YTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgcmVuZGVyUGFnZSA9ICgpPT57XG4gICAgICAgICAgICAgICAgdmFyIGdldFBhZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHJvdXRlRGF0YS5hcHArJy0nK3JvdXRlRGF0YS5wYWdlKTtcbiAgICAgICAgICAgICAgICBnZXRQYWdlLnJvdXRlID0gcm91dGVEYXRhO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRMb2NhbGVzKHRoaXMubGF5b3V0LHJvdXRlRGF0YS5hcHAsKGRhdGEpPT57XG4gICAgICAgICAgICAgICAgICB3aW5kb3cubWVyZ2VMb2NhbGVzID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgIGlmKCh0aGlzLmxheW91dCE9dGhpcy5vbGRMYXlvdXQpKXtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVuZGVyTGF5b3V0ID0gKCk9PntcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnlUYWcgPSB0aGlzLiQkKCd0YWctYXBwLWxvYWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICBxdWVyeVRhZy5pbm5lckhUTUw9Jyc7XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIGdldExheW91dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGhpcy5sYXlvdXQpO1xuICAgICAgICAgICAgICAgICAgICAgIGdldExheW91dC5yb3V0ZSA9IHJvdXRlRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICBnZXRMYXlvdXQucGFnZSA9IGdldFBhZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcuYXBwZW5kQ2hpbGQoZ2V0TGF5b3V0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmKGluaXRTeXN0ZW0ubGF5b3V0IT10aGlzLmxheW91dCl7XG5cbiAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmltcG9ydEhyZWYoXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZVVybCgnL3NyYy90ZW1wbGF0ZS8nK3RoaXMubGF5b3V0KycvJyt0aGlzLmxheW91dCsnLmh0bWwnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJMYXlvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAoZSk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VQYXRoKCcvZXJyb3IvNDA0JylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRydWVcbiAgICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgIHJlbmRlckxheW91dCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9ZWxzZSBpZih0eXBlb2YgdGhpcy5sYXlvdXQgPT0gXCJ1bmRlZmluZWRcIil7XG4gICAgICAgICAgICAgICAgICAgIHZhciBxdWVyeVRhZyA9IHRoaXMuJCQoJ3RhZy1hcHAtbG9hZCcpO1xuICAgICAgICAgICAgICAgICAgICBxdWVyeVRhZy5pbm5lckhUTUw9Jyc7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLmFwcGVuZENoaWxkKGdldFBhZ2UpO1xuICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHZhciBxdWVyeVRhZyA9IHRoaXMuJCQoJ3RhZy1hcHAtbG9hZD4nK3RoaXMubGF5b3V0KTtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcucm91dGUgPSByb3V0ZURhdGE7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLnBhZ2UgPSBnZXRQYWdlO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICB0aGlzLm9sZExheW91dCA9IHRoaXMubGF5b3V0O1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgaWYodGhpcy5jaGVja1JvbGUocm91dGVEYXRhKSl7XG4gICAgICAgICAgICByb3V0ZURhdGEgPSB7IGFwcDonZXJyb3InLHBhZ2U6JzQwMycgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLmltcG9ydEhyZWYoXG4gICAgICAgICAgICB0aGlzLnJlc29sdmVVcmwoJy9zcmMvYXBwcy8nK3JvdXRlRGF0YS5hcHArJy8nK3JvdXRlRGF0YS5wYWdlKycuaHRtbCcpLFxuICAgICAgICAgICAgKGUpPT57XG4gICAgICAgICAgICAgIHJlbmRlclBhZ2UoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZSk9PntcbiAgICAgICAgICAgICAgICByb3V0ZURhdGEgPSB7IGFwcDonZXJyb3InLHBhZ2U6JzQwNCcgfTtcbiAgICAgICAgICAgICAgICB0aGlzLmltcG9ydEhyZWYoXG4gICAgICAgICAgICAgICAgICB0aGlzLnJlc29sdmVVcmwoJy9zcmMvYXBwcy8nK3JvdXRlRGF0YS5hcHArJy8nK3JvdXRlRGF0YS5wYWdlKycuaHRtbCcpLFxuICAgICAgICAgICAgICAgICAgKGUpPT57XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlclBhZ2UoKTtcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgICAgdHJ1ZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdHJ1ZVxuICAgICAgICAgICk7XG4gICAgICAgICAgXG4gICAgICAgIFxuICAgICAgICB9XG5cblxuICAgICAgICBjaGFuZ2VQYXRoKHBhdGgpe1xuICAgICAgICAgIHRoaXMuJC5jaGFuZ2VQYXRoLnNldEF0dHJpYnV0ZShcImhyZWZcIiwgcGF0aCk7XG4gICAgICAgICAgdGhpcy4kLmNoYW5nZVBhdGguY2xpY2soKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgZ2V0TG9jYWxlcyhsYXlvdXQsYXBwLGNhbGxiYWNrKXtcblxuICAgICAgICAgIHZhciBtZXJnZUxvY2FsZXMgPSAoKSA9PiB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBtZXJnZURhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGxvY2FsZXMuZ2xvYmFsKSk7XG4gICAgICBcblxuICAgICAgICAgICAgaWYodHlwZW9mIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdICE9IFwidW5kZWZpbmVkXCIpe1xuICAgICAgICAgICAgICBmb3IodmFyIGtleSBpbiBsb2NhbGVzLmxheW91dHNbbGF5b3V0XSkge1xuICAgICAgICAgICAgICAgICAgZm9yKHZhciBrZXkyIGluIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdW2tleV0pIHtcbiAgICAgICAgICAgICAgICAgICAgbWVyZ2VEYXRhW2tleV1ba2V5Ml0gPSBsb2NhbGVzLmxheW91dHNbbGF5b3V0XVtrZXldW2tleTJdO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IFxuXG4gICAgICAgICAgICBmb3IodmFyIGtleSBpbiBsb2NhbGVzLmFwcHNbYXBwXSkge1xuICAgICAgICAgICAgICAgIGZvcih2YXIga2V5MiBpbiBsb2NhbGVzLmFwcHNbYXBwXVtrZXldKSB7XG4gICAgICAgICAgICAgICAgICBtZXJnZURhdGFba2V5XVtrZXkyXSA9IGxvY2FsZXMuYXBwc1thcHBdW2tleV1ba2V5Ml07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbGJhY2sobWVyZ2VEYXRhKTtcblxuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciBsb2NhbGVzTG9hZGVkID0ge1xuICAgICAgICAgICAgZ2xvYmFsOmZhbHNlLFxuICAgICAgICAgICAgbGF5b3V0OmZhbHNlLFxuICAgICAgICAgICAgYXBwOmZhbHNlLFxuICAgICAgICAgICAgbG9hZGVkOmZ1bmN0aW9uIChwb2ludGVyKSB7XG4gICAgICAgICAgICAgIHRoaXNbcG9pbnRlcl0gPSB0cnVlO1xuICAgICAgICAgICAgICBpZih0aGlzLmdsb2JhbCYmdGhpcy5sYXlvdXQmJnRoaXMuYXBwKXtcbiAgICAgICAgICAgICAgICBtZXJnZUxvY2FsZXMoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuXG4gICAgICAgICAgaWYodHlwZW9mIGxvY2FsZXMgPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgICAgd2luZG93LmxvY2FsZXMgPSB7Z2xvYmFsOm51bGwsYXBwczp7fSxsYXlvdXRzOnt9fTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZihsb2NhbGVzLmdsb2JhbD09bnVsbCl7XG4gICAgICAgICAgICBheGlvcy5nZXQoJy9zcmMvYXBwcy9sb2NhbGl6ZS5qc29uJylcbiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSk9PntcbiAgICAgICAgICAgICAgbG9jYWxlcy5nbG9iYWwgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnZ2xvYmFsJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2dsb2JhbCcpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmKHR5cGVvZiBsb2NhbGVzLmxheW91dHNbbGF5b3V0XSA9PSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgICBheGlvcy5nZXQoJy9zcmMvdGVtcGxhdGUvJytsYXlvdXQrJy9sb2NhbGl6ZS5qc29uJylcbiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSk9PntcbiAgICAgICAgICAgICAgbG9jYWxlcy5sYXlvdXRzW2xheW91dF0gPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnbGF5b3V0Jyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2xheW91dCcpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmKHR5cGVvZiBsb2NhbGVzLmFwcHNbYXBwXSA9PSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgICBheGlvcy5nZXQoJy9zcmMvYXBwcy8nK2FwcCsnL2xvY2FsaXplLmpzb24nKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKT0+e1xuICAgICAgICAgICAgICBsb2NhbGVzLmFwcHNbYXBwXSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdhcHAnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnYXBwJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuXG4gICAgICAgIGNoZWNrUm9sZShhcHApe1xuICAgICAgICAgIHZhciByZWRpcmVjdCA9IHRydWU7XG4gICAgICAgICAgdGhpcy5yb2xlLm1hcCgob2JqLGluZGV4KT0+e1xuICAgICAgICAgICAgaWYob2JqLnBhdGg9PShhcHAuYXBwKycvJythcHAucGFnZSkpe1xuICAgICAgICAgICAgICBvYmoucm9sZS5tYXAoKHNPYmopPT57XG4gICAgICAgICAgICAgICAgaWYodGhpcy5hdXRoLnJvbGU9PXNPYmope1xuICAgICAgICAgICAgICAgICAgcmVkaXJlY3QgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgIHJlZGlyZWN0ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICByZXR1cm4gcmVkaXJlY3Q7XG4gICAgICAgIH1cbiAgICAgICAgICBcblxuICAgICAgfVxuXG4gICAgICBQb2x5bWVyKE54U3lzdGVtKTtcblxuICAgIH0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
