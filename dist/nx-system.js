"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var o=a[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(a,t,o){return t&&e(a.prototype,t),o&&e(a,o),a}}();!function(){window.nxQuerySystem=document.querySelector("nx-system"),window.nxQueryLocalize={};var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"beforeRegister",value:function(){this.is="nx-system",this.properties={role:{type:Object,value:[{path:"app1/page1",role:["admin","manager","user1"]}]}}}},{key:"created",value:function(){"undefined"==typeof localStorage.nxLanguage&&localStorage.setItem("nxLanguage",initSystem.language);var e=jwt_decode("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiVXNlcjEiLCJyb2xlIjoiYWRtaW4ifQ.oRx_ieJoxSZPv7Y8lM03Qv8Qb24PVmuFpWBUxWEkBcg");this.auth=e}},{key:"_routePageChanged",value:function(e){var a=this,t={};if("/"==e.path){var o=initSystem.indexPath.split("/");t={app:o[1],page:o[2]}}else t="undefined"==typeof e.path.split("/")[2]?{app:"error",page:"404"}:this.routeData;var l=function(){var e=document.createElement(t.app+"-"+t.page);e.route=t,a.getLocales(a.layout,t.app,function(o){if(window.mergeLocales=o,a.layout!=a.oldLayout)if("layout-main"!=initSystem.layout){var l=function(){var o=a.$$("tag-app-load");o.innerHTML="";var l=document.createElement(a.layout);l.route=t,l.page=e,o.appendChild(l)};a.importHref(a.resolveUrl("/src/template/"+a.layout+"/"+a.layout+".html"),function(e){l()},function(e){a.changePath("/error/404")},!0)}else l();else if("undefined"==typeof a.layout){var n=a.$$("tag-app-load");n.innerHTML="",n.appendChild(e)}else{var n=a.$$("tag-app-load>"+a.layout);n.route=t,n.page=e}a.oldLayout=a.layout})};this.checkRole(t)&&(t={app:"error",page:"403"}),this.importHref(this.resolveUrl("/src/apps/"+t.app+"/"+t.page+".html"),function(e){l()},function(e){t={app:"error",page:"404"},a.importHref(a.resolveUrl("/src/apps/"+t.app+"/"+t.page+".html"),function(e){l()},null,!0)},!0)}},{key:"changePath",value:function(e){this.$.changePath.setAttribute("href",e),this.$.changePath.click()}},{key:"getLocales",value:function(e,a,t){var o=function(){var o=JSON.parse(JSON.stringify(locales.global));if("undefined"!=typeof locales.layouts[e])for(var l in locales.layouts[e])for(var n in locales.layouts[e][l])o[l][n]=locales.layouts[e][l][n];for(var l in locales.apps[a])for(var n in locales.apps[a][l])o[l][n]=locales.apps[a][l][n];t(o)},l={global:!1,layout:!1,app:!1,loaded:function(e){this[e]=!0,this.global&&this.layout&&this.app&&o()}};"undefined"==typeof locales&&(window.locales={global:null,apps:{},layouts:{}}),null==locales.global?axios.get("/src/apps/localize.json").then(function(e){locales.global=e.data,l.loaded("global")}):l.loaded("global"),"undefined"==typeof locales.layouts[e]?axios.get("/src/template/"+e+"/localize.json").then(function(a){locales.layouts[e]=a.data,l.loaded("layout")}):l.loaded("layout"),"undefined"==typeof locales.apps[a]?axios.get("/src/apps/"+a+"/localize.json").then(function(e){locales.apps[a]=e.data,l.loaded("app")}):l.loaded("app")}},{key:"checkRole",value:function(e){var a=this,t=!0;return this.role.map(function(o,l){o.path==e.app+"/"+e.page?o.role.map(function(e){a.auth.role==e&&(t=!1)}):t=!1}),t}},{key:"observers",get:function(){return["_routePageChanged(route)"]}}]),e}();Polymer(e)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm54LXN5c3RlbS5qcyJdLCJuYW1lcyI6WyJ3aW5kb3ciLCJueFF1ZXJ5U3lzdGVtIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibnhRdWVyeUxvY2FsaXplIiwiTnhTeXN0ZW0iLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiX2NyZWF0ZUNsYXNzIiwia2V5IiwidmFsdWUiLCJpcyIsInByb3BlcnRpZXMiLCJyb2xlIiwidHlwZSIsIk9iamVjdCIsInBhdGgiLCJsb2NhbFN0b3JhZ2UiLCJueExhbmd1YWdlIiwic2V0SXRlbSIsImluaXRTeXN0ZW0iLCJsYW5ndWFnZSIsImRlY29kZWQiLCJqd3RfZGVjb2RlIiwiX3RoaXMiLCJyb3V0ZURhdGEiLCJnZXRSb3V0ZSIsImluZGV4UGF0aCIsInNwbGl0IiwiYXBwIiwicGFnZSIsInJlbmRlclBhZ2UiLCJnZXRQYWdlIiwicm91dGUiLCJnZXRMb2NhbGVzIiwibGF5b3V0IiwiZGF0YSIsIm1lcmdlTG9jYWxlcyIsInJlbmRlckxheW91dCIsIiQkIiwiaW5uZXJIVE1MIiwib2xkTGF5b3V0IiwiZ2V0TGF5b3V0IiwiY3JlYXRlRWxlbWVudCIsInF1ZXJ5VGFnIiwiaW1wb3J0SHJlZiIsImFwcGVuZENoaWxkIiwiY2hlY2tSb2xlIiwicmVzb2x2ZVVybCIsImUiLCJjaGFuZ2VQYXRoIiwibWVyZ2VEYXRhIiwiJCIsInNldEF0dHJpYnV0ZSIsImNsaWNrIiwibG9jYWxlcyIsImNhbGxiYWNrIiwiSlNPTiIsInBhcnNlIiwic3RyaW5naWZ5IiwiZ2xvYmFsIiwibG9jYWxlc0xvYWRlZCIsImxheW91dHMiLCJrZXkyIiwiYXBwcyIsImF4aW9zIiwibG9hZGVkIiwicG9pbnRlciIsImdldCIsInRoZW4iLCJyZXNwb25zZSIsInJlZGlyZWN0Iiwib2JqIiwiX3RoaXMyIiwibWFwIiwiaW5kZXgiLCJzT2JqIiwiYXV0aCIsIlBvbHltZXIiXSwibWFwcGluZ3MiOiI4WEFBQSxXQUdNQSxPQUFPQyxjQUFnQkMsU0FB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QUFBLEdBQUE0QyxHQUFBbEUsS0FaR2dFLEdBQUEsQ0EwTkYsT0FaQWhFLE1BQUtNLEtBQUs2RCxJQUFJLFNBQUNGLEVBQUlHLEdBOU1qQkgsRUFBQXhELE1BQUFhLEVBQUFBLElBQUEsSUFBQUEsRUFBQUMsS0FBQTBDLEVBQUEzRCxLQUFBNkQsSUFBQSxTQUFBRSxHQWlOT0gsRUFBS0ksS0FBS2hFLE1BQU0rRCxJQWU3QkwsR0FBQSxLQVZRQSxHQUFXLElBSVJBLEtBMU5MOUQsSUFBQSxZQUFBMkQsSUFBQSxXQUdDbkUsT0FDQUcsZ0NBSkRDLElBZ09OeUUsU0FBUXpFIiwiZmlsZSI6Im54LXN5c3RlbS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgICAgICd1c2Ugc3RyaWN0JztcblxuICAgICAgd2luZG93Lm54UXVlcnlTeXN0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibngtc3lzdGVtXCIpO1xuICAgICAgd2luZG93Lm54UXVlcnlMb2NhbGl6ZSA9IHt9O1xuXG4gICAgICBjbGFzcyBOeFN5c3RlbSB7XG5cbiAgICAgICAgZ2V0IG9ic2VydmVycygpIHtcbiAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgJ19yb3V0ZVBhZ2VDaGFuZ2VkKHJvdXRlKSdcbiAgICAgICAgICBdO1xuICAgICAgICB9XG5cbiAgICAgICAgYmVmb3JlUmVnaXN0ZXIoKSB7XG4gICAgICAgICAgdGhpcy5pcyA9ICdueC1zeXN0ZW0nO1xuICAgICAgICAgIHRoaXMucHJvcGVydGllcyA9IHtcbiAgICAgICAgICAgIHJvbGU6e1xuICAgICAgICAgICAgICB0eXBlOk9iamVjdCxcbiAgICAgICAgICAgICAgdmFsdWU6W1xuICAgICAgICAgICAgICAgIHsgcGF0aDonYXBwMS9wYWdlMScscm9sZTpbJ2FkbWluJywnbWFuYWdlcicsJ3VzZXIxJ119XG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY3JlYXRlZCgpe1xuICAgICAgICAgIGlmKHR5cGVvZiBsb2NhbFN0b3JhZ2UubnhMYW5ndWFnZSA9PSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcIm54TGFuZ3VhZ2VcIiwgaW5pdFN5c3RlbS5sYW5ndWFnZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGRlY29kZWQgPSBqd3RfZGVjb2RlKCdleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKMWMyVnlJam9pVlhObGNqRWlMQ0p5YjJ4bElqb2lZV1J0YVc0aWZRLm9SeF9pZUpveFNaUHY3WThsTTAzUXY4UWIyNFBWbXVGcFdCVXhXRWtCY2cnKTtcbiAgICAgICAgICB0aGlzLmF1dGggPSBkZWNvZGVkO1xuICAgICAgICB9XG5cbiAgICAgICAgX3JvdXRlUGFnZUNoYW5nZWQoZ2V0Um91dGUpe1xuXG4gICAgICAgICAgdmFyIHJvdXRlRGF0YSA9IHt9O1xuICAgICAgICAgIGlmKGdldFJvdXRlLnBhdGggPT0gXCIvXCIpe1xuICAgICAgICAgICAgdmFyIGluZGV4UGF0aCA9IGluaXRTeXN0ZW0uaW5kZXhQYXRoLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICByb3V0ZURhdGEgPSB7IGFwcDppbmRleFBhdGhbMV0scGFnZTppbmRleFBhdGhbMl0gfTtcbiAgICAgICAgICB9ZWxzZSBpZih0eXBlb2YgZ2V0Um91dGUucGF0aC5zcGxpdCgnLycpWzJdID09IFwidW5kZWZpbmVkXCIpe1xuICAgICAgICAgICAgcm91dGVEYXRhID0geyBhcHA6J2Vycm9yJyxwYWdlOic0MDQnIH07XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICByb3V0ZURhdGEgPSB0aGlzLnJvdXRlRGF0YTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgcmVuZGVyUGFnZSA9ICgpPT57XG4gICAgICAgICAgICAgICAgdmFyIGdldFBhZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHJvdXRlRGF0YS5hcHArJy0nK3JvdXRlRGF0YS5wYWdlKTtcbiAgICAgICAgICAgICAgICBnZXRQYWdlLnJvdXRlID0gcm91dGVEYXRhO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRMb2NhbGVzKHRoaXMubGF5b3V0LHJvdXRlRGF0YS5hcHAsKGRhdGEpPT57XG4gICAgICAgICAgICAgICAgICB3aW5kb3cubWVyZ2VMb2NhbGVzID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgIGlmKCh0aGlzLmxheW91dCE9dGhpcy5vbGRMYXlvdXQpKXtcblxuICAgICAgICAgICAgICAgICAgICBpZihpbml0U3lzdGVtLmxheW91dCE9XCJsYXlvdXQtbWFpblwiKXtcblxuICAgICAgICAgICAgICAgICAgICAgIHZhciByZW5kZXJMYXlvdXQgPSAoKT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5VGFnID0gdGhpcy4kJCgndGFnLWFwcC1sb2FkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVRhZy5pbm5lckhUTUw9Jyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ2V0TGF5b3V0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0aGlzLmxheW91dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRMYXlvdXQucm91dGUgPSByb3V0ZURhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRMYXlvdXQucGFnZSA9IGdldFBhZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVRhZy5hcHBlbmRDaGlsZChnZXRMYXlvdXQpO1xuICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW1wb3J0SHJlZihcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlVXJsKCcvc3JjL3RlbXBsYXRlLycrdGhpcy5sYXlvdXQrJy8nK3RoaXMubGF5b3V0KycuaHRtbCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgKGUpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlckxheW91dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZVBhdGgoJy9lcnJvci80MDQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgcmVuZGVyTGF5b3V0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKHR5cGVvZiB0aGlzLmxheW91dCA9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5VGFnID0gdGhpcy4kJCgndGFnLWFwcC1sb2FkJyk7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5VGFnLmlubmVySFRNTD0nJztcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcuYXBwZW5kQ2hpbGQoZ2V0UGFnZSk7XG4gICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5VGFnID0gdGhpcy4kJCgndGFnLWFwcC1sb2FkPicrdGhpcy5sYXlvdXQpO1xuICAgICAgICAgICAgICAgICAgICBxdWVyeVRhZy5yb3V0ZSA9IHJvdXRlRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlUYWcucGFnZSA9IGdldFBhZ2U7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIHRoaXMub2xkTGF5b3V0ID0gdGhpcy5sYXlvdXQ7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICBpZih0aGlzLmNoZWNrUm9sZShyb3V0ZURhdGEpKXtcbiAgICAgICAgICAgIHJvdXRlRGF0YSA9IHsgYXBwOidlcnJvcicscGFnZTonNDAzJyB9O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuaW1wb3J0SHJlZihcbiAgICAgICAgICAgIHRoaXMucmVzb2x2ZVVybCgnL3NyYy9hcHBzLycrcm91dGVEYXRhLmFwcCsnLycrcm91dGVEYXRhLnBhZ2UrJy5odG1sJyksXG4gICAgICAgICAgICAoZSk9PntcbiAgICAgICAgICAgICAgcmVuZGVyUGFnZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlKT0+e1xuICAgICAgICAgICAgICAgIHJvdXRlRGF0YSA9IHsgYXBwOidlcnJvcicscGFnZTonNDA0JyB9O1xuICAgICAgICAgICAgICAgIHRoaXMuaW1wb3J0SHJlZihcbiAgICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZVVybCgnL3NyYy9hcHBzLycrcm91dGVEYXRhLmFwcCsnLycrcm91dGVEYXRhLnBhZ2UrJy5odG1sJyksXG4gICAgICAgICAgICAgICAgICAoZSk9PntcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyUGFnZSgpO1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICB0cnVlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0cnVlXG4gICAgICAgICAgKTtcbiAgICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIH1cblxuXG4gICAgICAgIGNoYW5nZVBhdGgocGF0aCl7XG4gICAgICAgICAgdGhpcy4kLmNoYW5nZVBhdGguc2V0QXR0cmlidXRlKFwiaHJlZlwiLCBwYXRoKTtcbiAgICAgICAgICB0aGlzLiQuY2hhbmdlUGF0aC5jbGljaygpO1xuICAgICAgICB9XG5cblxuICAgICAgICBnZXRMb2NhbGVzKGxheW91dCxhcHAsY2FsbGJhY2spe1xuXG4gICAgICAgICAgdmFyIG1lcmdlTG9jYWxlcyA9ICgpID0+IHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIG1lcmdlRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobG9jYWxlcy5nbG9iYWwpKTtcbiAgICAgIFxuXG4gICAgICAgICAgICBpZih0eXBlb2YgbG9jYWxlcy5sYXlvdXRzW2xheW91dF0gIT0gXCJ1bmRlZmluZWRcIil7XG4gICAgICAgICAgICAgIGZvcih2YXIga2V5IGluIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdKSB7XG4gICAgICAgICAgICAgICAgICBmb3IodmFyIGtleTIgaW4gbG9jYWxlcy5sYXlvdXRzW2xheW91dF1ba2V5XSkge1xuICAgICAgICAgICAgICAgICAgICBtZXJnZURhdGFba2V5XVtrZXkyXSA9IGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdW2tleV1ba2V5Ml07XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gXG5cbiAgICAgICAgICAgIGZvcih2YXIga2V5IGluIGxvY2FsZXMuYXBwc1thcHBdKSB7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBrZXkyIGluIGxvY2FsZXMuYXBwc1thcHBdW2tleV0pIHtcbiAgICAgICAgICAgICAgICAgIG1lcmdlRGF0YVtrZXldW2tleTJdID0gbG9jYWxlcy5hcHBzW2FwcF1ba2V5XVtrZXkyXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYWxsYmFjayhtZXJnZURhdGEpO1xuXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGxvY2FsZXNMb2FkZWQgPSB7XG4gICAgICAgICAgICBnbG9iYWw6ZmFsc2UsXG4gICAgICAgICAgICBsYXlvdXQ6ZmFsc2UsXG4gICAgICAgICAgICBhcHA6ZmFsc2UsXG4gICAgICAgICAgICBsb2FkZWQ6ZnVuY3Rpb24gKHBvaW50ZXIpIHtcbiAgICAgICAgICAgICAgdGhpc1twb2ludGVyXSA9IHRydWU7XG4gICAgICAgICAgICAgIGlmKHRoaXMuZ2xvYmFsJiZ0aGlzLmxheW91dCYmdGhpcy5hcHApe1xuICAgICAgICAgICAgICAgIG1lcmdlTG9jYWxlcygpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG5cbiAgICAgICAgICBpZih0eXBlb2YgbG9jYWxlcyA9PSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgICB3aW5kb3cubG9jYWxlcyA9IHtnbG9iYWw6bnVsbCxhcHBzOnt9LGxheW91dHM6e319O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmKGxvY2FsZXMuZ2xvYmFsPT1udWxsKXtcbiAgICAgICAgICAgIGF4aW9zLmdldCgnL3NyYy9hcHBzL2xvY2FsaXplLmpzb24nKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKT0+e1xuICAgICAgICAgICAgICBsb2NhbGVzLmdsb2JhbCA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdnbG9iYWwnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnZ2xvYmFsJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYodHlwZW9mIGxvY2FsZXMubGF5b3V0c1tsYXlvdXRdID09ICd1bmRlZmluZWQnKXtcbiAgICAgICAgICAgIGF4aW9zLmdldCgnL3NyYy90ZW1wbGF0ZS8nK2xheW91dCsnL2xvY2FsaXplLmpzb24nKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKT0+e1xuICAgICAgICAgICAgICBsb2NhbGVzLmxheW91dHNbbGF5b3V0XSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdsYXlvdXQnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBsb2NhbGVzTG9hZGVkLmxvYWRlZCgnbGF5b3V0Jyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYodHlwZW9mIGxvY2FsZXMuYXBwc1thcHBdID09ICd1bmRlZmluZWQnKXtcbiAgICAgICAgICAgIGF4aW9zLmdldCgnL3NyYy9hcHBzLycrYXBwKycvbG9jYWxpemUuanNvbicpXG4gICAgICAgICAgICAudGhlbigocmVzcG9uc2UpPT57XG4gICAgICAgICAgICAgIGxvY2FsZXMuYXBwc1thcHBdID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgbG9jYWxlc0xvYWRlZC5sb2FkZWQoJ2FwcCcpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGxvY2FsZXNMb2FkZWQubG9hZGVkKCdhcHAnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG5cbiAgICAgICAgY2hlY2tSb2xlKGFwcCl7XG4gICAgICAgICAgdmFyIHJlZGlyZWN0ID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLnJvbGUubWFwKChvYmosaW5kZXgpPT57XG4gICAgICAgICAgICBpZihvYmoucGF0aD09KGFwcC5hcHArJy8nK2FwcC5wYWdlKSl7XG4gICAgICAgICAgICAgIG9iai5yb2xlLm1hcCgoc09iaik9PntcbiAgICAgICAgICAgICAgICBpZih0aGlzLmF1dGgucm9sZT09c09iail7XG4gICAgICAgICAgICAgICAgICByZWRpcmVjdCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgcmVkaXJlY3QgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHJldHVybiByZWRpcmVjdDtcbiAgICAgICAgfVxuICAgICAgICAgIFxuXG4gICAgICB9XG5cbiAgICAgIFBvbHltZXIoTnhTeXN0ZW0pO1xuXG4gICAgfSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
